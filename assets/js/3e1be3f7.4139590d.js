"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[2339],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>u});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=p(n),u=o,k=c["".concat(s,".").concat(u)]||c[u]||d[u]||i;return n?a.createElement(k,r(r({ref:t},m),{},{components:n})):a.createElement(k,r({ref:t},m))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},31536:(e,t,n)=>{n.d(t,{Z:()=>x});var a=n(80102),o=n(83117),i=n(67294),r=n(10209),l=n(59766),s=n(94780),p=n(34867);const m=(0,n(70182).ZP)();var d=n(65149),c=n(39707),u=n(66500),k=n(95408),h=n(98700),N=n(85893);const g=["component","direction","spacing","divider","children","className","useFlexGap"],b=(0,u.Z)(),f=m("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root});function y(e){return(0,d.Z)({props:e,name:"MuiStack",defaultTheme:b})}function v(e,t){const n=i.Children.toArray(e).filter(Boolean);return n.reduce(((e,a,o)=>(e.push(a),o<n.length-1&&e.push(i.cloneElement(t,{key:`separator-${o}`})),e)),[])}const C=({ownerState:e,theme:t})=>{let n=(0,o.Z)({display:"flex",flexDirection:"column"},(0,k.k9)({theme:t},(0,k.P$)({values:e.direction,breakpoints:t.breakpoints.values}),(e=>({flexDirection:e}))));if(e.spacing){const a=(0,h.hB)(t),o=Object.keys(t.breakpoints.values).reduce(((t,n)=>(("object"==typeof e.spacing&&null!=e.spacing[n]||"object"==typeof e.direction&&null!=e.direction[n])&&(t[n]=!0),t)),{}),i=(0,k.P$)({values:e.direction,base:o}),r=(0,k.P$)({values:e.spacing,base:o});"object"==typeof i&&Object.keys(i).forEach(((e,t,n)=>{if(!i[e]){const a=t>0?i[n[t-1]]:"column";i[e]=a}}));const s=(t,n)=>{return e.useFlexGap?{gap:(0,h.NA)(a,t)}:{"& > :not(style) ~ :not(style)":{margin:0,[`margin${o=n?i[n]:e.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[o]}`]:(0,h.NA)(a,t)}};var o};n=(0,l.Z)(n,(0,k.k9)({theme:t},r,s))}return n=(0,k.dt)(t.breakpoints,n),n};var E=n(90948),T=n(71657);const w=function(e={}){const{createStyledComponent:t=f,useThemeProps:n=y,componentName:l="MuiStack"}=e,m=t(C),d=i.forwardRef((function(e,t){const i=n(e),d=(0,c.Z)(i),{component:u="div",direction:k="column",spacing:h=0,divider:b,children:f,className:y,useFlexGap:C=!1}=d,E=(0,a.Z)(d,g),T={direction:k,spacing:h,useFlexGap:C},w=(0,s.Z)({root:["root"]},(e=>(0,p.Z)(l,e)),{});return(0,N.jsx)(m,(0,o.Z)({as:u,ownerState:T,ref:t,className:(0,r.Z)(w.root,y)},E,{children:b?v(f,b):f}))}));return d}({createStyledComponent:(0,E.ZP)("div",{name:"MuiStack",slot:"Root",overridesResolver:(e,t)=>t.root}),useThemeProps:e=>(0,T.Z)({props:e,name:"MuiStack"})}),x=w},86153:(e,t,n)=>{n.d(t,{_:()=>I});var a=n(67294),o=n(87357),i=n(83321),r=n(61903),l=n(23599),s=n(86886),p=n(67720),m=n(90629),d=n(7906),c=n(295),u=n(53252),k=n(72882),h=n(53184),N=n(53816),g=n(24661),b=n(96540),f=n(93946),y=n(41733),v=n(50657),C=n(31425),E=n(6514),T=n(58951),w=n(37645),x=n(52263),Z=n(59457),B=n(53143);const I=(0,a.memo)((()=>{const{i18n:e}=(0,x.Z)(),t=(0,B.S)(),n=(0,a.useMemo)((()=>t?S:O),[t]),I=(0,a.useMemo)((()=>{const e=new Map;for(const t of n)e.set(t.id,t);return e}),[n]),L=(0,a.useMemo)((()=>t?D:j),[t]),_=(0,a.useMemo)((()=>{const e=new Map;for(const t of L)e.set(t.id,t);return e}),[L]),[P,M]=(0,Z.x)((()=>({userId:1,province:I.get(1).province,city:I.get(1).city,address:I.get(1).address,items:[{__rowId:1,productId:1,name:_.get(1).name,quantity:2},{__rowId:2,productId:10,name:_.get(10).name,quantity:1}]}))),q=(0,a.useMemo)((()=>Math.max(...P.items.map((e=>e.__rowId)))+1),[P]),R=(0,a.useCallback)((e=>{const t=I.get(parseInt(e.target.value));void 0!==t&&M((e=>{e.userId=t.id,e.province=t.province,e.city=t.city,e.address=t.address}))}),[M,I]),F=(0,a.useCallback)((e=>{M((t=>{t.province=e.target.value}))}),[M]),K=(0,a.useCallback)((e=>{M((t=>{t.city=e.target.value}))}),[M]),U=(0,a.useCallback)((e=>{M((t=>{t.address=e.target.value}))}),[M]),z=(0,a.useCallback)(((e,t)=>{M((n=>{for(const a of n.items)if(a.__rowId===t){a.productId=parseInt(e.target.value),A(n);break}}))}),[M]),Q=(0,a.useCallback)(((e,t)=>{M((n=>{for(const a of n.items)if(a.__rowId===t){a.quantity=parseInt(e.target.value),A(n);break}}))}),[M]),G=(0,a.useCallback)((e=>{M((t=>{for(let n=t.items.length-1;n>=0;--n)if(t.items[n].__rowId===e){t.items.splice(n,1);break}}))}),[M]),H=(0,a.useCallback)((()=>{M((e=>{e.items.push({__rowId:q,quantity:1})}))}),[M,q]),[W,X]=(0,a.useState)(!1),J=(0,a.useCallback)((()=>{X(!0)}),[]),V=(0,a.useCallback)((()=>{X(!1)}),[]);return a.createElement(m.Z,{elevation:3,style:{padding:"1.5rem"}},a.createElement(o.Z,{component:"form",noValidate:!0,autoComplete:"off"},a.createElement(s.ZP,{container:!0,spacing:2},a.createElement(s.ZP,{item:!0,xs:4},a.createElement(r.Z,{fullWidth:!0,select:!0,label:t?"\u8d2d\u4e70\u4eba":"Purchaser",value:P.userId,onChange:R},n.map((e=>a.createElement(l.Z,{key:e.id,value:e.id},e.nickName))))),a.createElement(s.ZP,{item:!0,xs:4},a.createElement(r.Z,{fullWidth:!0,label:t?"\u7701\u4efd":"Province",value:P.province,onChange:F})),a.createElement(s.ZP,{item:!0,xs:4},a.createElement(r.Z,{fullWidth:!0,label:t?"\u57ce\u5e02":"City",value:P.city,onChange:K})),a.createElement(s.ZP,{item:!0,xs:12},a.createElement(r.Z,{fullWidth:!0,label:t?"\u5730\u5740":"Address",value:P.address,onChange:U})),a.createElement(s.ZP,{item:!0,xs:12},a.createElement(p.Z,{textAlign:"left"},t?"\u8ba2\u5355\u660e\u7ec6":"Order Items"),a.createElement(k.Z,{component:m.Z},a.createElement(d.Z,{size:"small"},a.createElement(h.Z,null,a.createElement(N.Z,null,a.createElement(u.Z,null,t?"\u5546\u54c1":"Commodity"),a.createElement(u.Z,null,t?"\u6570\u91cf":"Quantity"),a.createElement(u.Z,null,t?"\u5355\u4ef7":"Unit price"),a.createElement(u.Z,null,t?"\u660e\u7ec6\u4ef7":"Item price"),a.createElement(u.Z,null,t?"\u5220\u9664":"Delete"))),a.createElement(c.Z,null,P.items.map((e=>{const t=void 0!==e.productId?_.get(e.productId):void 0;return a.createElement(N.Z,{key:e.__rowId},a.createElement(u.Z,null,a.createElement(r.Z,{select:!0,value:null==t?void 0:t.id,variant:"standard",size:"small",onChange:t=>{z(t,e.__rowId)}},L.map((e=>a.createElement(l.Z,{key:e.id,value:e.id},e.name))))),a.createElement(u.Z,null,a.createElement(r.Z,{type:"number",value:e.quantity,variant:"standard",size:"small",onChange:t=>{Q(t,e.__rowId)}})),a.createElement(u.Z,null,null==t?void 0:t.price),a.createElement(u.Z,null,void 0!==t&&t.price*e.quantity),a.createElement(u.Z,null,a.createElement(f.Z,{onClick:()=>G(e.__rowId)},a.createElement(y.Z,null))))}))),a.createElement(g.Z,null,a.createElement(N.Z,null,a.createElement(u.Z,{colSpan:5},a.createElement(i.Z,{onClick:H},a.createElement(b.Z,null),t?"\u6dfb\u52a0":"Add"))))))),a.createElement(s.ZP,{item:!0,xs:12},t?"\u603b\u989d":"Total price",":",P.items.filter((e=>void 0!==e.productId&&"number"==typeof e.quantity)).map((e=>_.get(e.productId).price*e.quantity)).reduce(((e,t)=>e+t),0)),a.createElement(s.ZP,{item:!0,xs:12},a.createElement(i.Z,{variant:"contained",onClick:J},t?"\u63d0\u4ea4":"Submit")))),a.createElement(v.Z,{open:W,onClose:V},a.createElement(w.Z,null,t?"\u4fe1\u606f":"Info"),a.createElement(E.Z,null,a.createElement(T.Z,null,t?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect")),a.createElement(C.Z,null,a.createElement(i.Z,{onClick:V},t?"\u5173\u95ed":"Close"))))})),S=[{id:1,nickName:"\u76ae\u76ae\u9c81",province:"\u56db\u5ddd",city:"\u6210\u90fd",address:"\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3"},{id:2,nickName:"\u9c81\u897f\u897f",province:"\u5e7f\u4e1c",city:"\u5e7f\u5dde",address:"\u767d\u4e91\u533a\u77f3\u6c99\u8def300\u53f7"},{id:3,nickName:"\u8212\u514b",province:"\u897f\u85cf",city:"\u62c9\u8428",address:"\u5806\u9f99\u5fb7\u5e86\u533a"},{id:4,nickName:"\u8d1d\u5854",province:"\u4e0a\u6d77",city:"\u4e0a\u6d77",address:"\u6d66\u4e1c\u65b0\u533a\u79c0\u6cbf\u897f\u8def218\u5f04"}],O=[{id:1,nickName:"Schneewittchen",province:"Berlin",city:"Prenzlauer Berg",address:"Brandenburgische Stra\xdfe 9, Prenzlauer Berg, Berlin, Germany"},{id:2,nickName:"Cinderella",province:"Basse-Normandie",city:"Lisieux",address:"20 rue L\xe9on Dierx, Lisieux, Basse-Normandie, France"},{id:3,nickName:"Nuwa",province:"ShanXi",city:"Taiyuan",address:"Qian Feng Nan Lu 99hao, Taiyuan, ShanXi, China"},{id:4,nickName:"Pinocchio",province:"Palazzo Pignano",city:"Cremona",address:"Via Giovanni Amendola 134, Palazzo Pignano, Cremona, Italy"}],D=[{id:1,name:"zippo\u591c\u5149\u6d41\u6c99\u6253\u706b\u673a",price:268},{id:2,name:"\u6770\u767b(Jayden)\u5370\u5ea6\u5854\u5e03\u62c9\u9f13",price:9238},{id:3,name:"\u6d6a\u7434(Longines)\u673a\u68b0\u624b\u8868",price:13900},{id:4,name:"viney\u7537\u58eb\u76ae\u5e26",price:139},{id:5,name:"\u96c5\u8bd7\u5170\u9edb\u7ed2\u96fe\u54d1\u5149\u5507\u818f",price:310},{id:6,name:"CIRCUIT\u7537\u5b50\u6ed1\u96ea\u5355\u677f",price:2044},{id:7,name:"\u7279\u4ed1\u82cf\u8131\u8102\u725b\u5976",price:47},{id:8,name:"\u4e50\u9ad8\u79ef\u6728\u5e03\u52a0\u8fea",price:374},{id:9,name:"\u53cc\u559c\u71c3\u6c14\u7535\u78c1\u901a\u7528\u538b\u529b\u9505",price:137},{id:10,name:"\u61a8\u61a8\u5ba0\u732b\u722c\u67b6",price:238}],j=[{id:1,name:"Timeless Vitamin C Plus E 10 Percent Ferulic Acid Serum Serum Unisex 1 oz",price:14.69},{id:2,name:"Dockers Men's Tiller Boat Shoe",price:52.41},{id:3,name:"Paxcoo 124 Skeins Embroidery Floss Cross Stitch Thread with Needles",price:29.99},{id:4,name:"Michael Kors Crossbody",price:70.6},{id:5,name:"Crocs unisex-child Classic Graphic Clog",price:34.99},{id:6,name:"Timex Time Machines Digital 35mm Watch",price:28.95},{id:7,name:"Scalex Mite & Lice Spray for Birds, 8 oz.",price:14.75},{id:8,name:"Under Armour Men's Storm Liner",price:13.03},{id:9,name:"Nike Women's Pro 3\" Training Shorts",price:35.86},{id:10,name:"Olaplex No. 4 Bond Maintenance Shampoo",price:30}];function A(e){const t=e.items,n=new Map;for(let a=0;a<t.length;a++){const e=t[a];if("number"!=typeof e.quantity)e.quantity=1;else if(e.quantity<1){t.splice(a--,1);continue}if(void 0===e.productId)continue;const o=n.get(e.productId);void 0===o?n.set(e.productId,e):(o.quantity+=e.quantity,t.splice(a--,1))}}},20036:(e,t,n)=>{n.d(t,{k:()=>b});var a=n(52263),o=n(94054),i=n(33841),r=n(23599),l=n(90629),s=n(43246),p=n(31536),m=n(61903),d=n(50657),c=n(37645),u=n(6514),k=n(31425),h=n(58951),N=n(83321),g=n(67294);const b=(0,g.memo)((()=>{const[e,t]=(0,g.useState)((()=>({name:"Learning GraphQL",edition:1,price:45,storeId:1,authorIds:[1,2]}))),n=(0,g.useCallback)((e=>{t((t=>({...t,name:e.target.value})))}),[]),b=(0,g.useCallback)((e=>{t((t=>({...t,edition:e.target.valueAsNumber})))}),[]),f=(0,g.useCallback)((e=>{t((t=>({...t,price:e.target.valueAsNumber})))}),[]),y=(0,g.useCallback)((e=>{let n;const a=e.target.value;n="string"==typeof a?parseInt(a):a,-1===n&&(n=void 0),t((e=>({...e,storeId:n})))}),[]),v=(0,g.useCallback)((e=>{let n=[];console.log(e.target.value);const a=e.target.value;n="string"==typeof a?a.split(",").map((e=>parseInt(e))):a,t((e=>({...e,authorIds:n})))}),[]),{i18n:C}=(0,a.Z)(),E=(0,g.useMemo)((()=>"zh"==C.currentLocale||"zh_cn"==C.currentLocale||"zh_CN"==C.currentLocale),[C.currentLocale]),[T,w]=(0,g.useState)(!1),x=(0,g.useCallback)((()=>{w(!0)}),[]),Z=(0,g.useCallback)((()=>{w(!1)}),[]);return g.createElement(l.Z,{elevation:3,style:{padding:"1.5rem",width:500}},g.createElement(p.Z,{spacing:2},g.createElement("h1",null,"Book Form"),g.createElement(m.Z,{label:"Name",value:e.name,onChange:n,error:""===e.name,helperText:""===e.name?"Name is required":""}),g.createElement(m.Z,{label:"Edition",type:"number",value:e.edition,onChange:b}),g.createElement(m.Z,{label:"Price",type:"number",value:e.price,onChange:f}),g.createElement(o.Z,{fullWidth:!0},g.createElement(i.Z,{id:"store-select-label"},"Store"),g.createElement(s.Z,{labelId:"store-select-label",label:"Authors",value:e.storeId,onChange:y},g.createElement(r.Z,{value:-1},"--NONE--"),g.createElement(r.Z,{value:1},"O'REILLY"),g.createElement(r.Z,{value:2},"MANNING"))),g.createElement(o.Z,{fullWidth:!0},g.createElement(i.Z,{id:"author-multi-select-label"},"Authors"),g.createElement(s.Z,{multiple:!0,labelId:"author-multi-select-label",label:"Authors",value:e.authorIds,onChange:v},g.createElement(r.Z,{value:1},"Eve Procello"),g.createElement(r.Z,{value:2},"Alex Banks"),g.createElement(r.Z,{value:3},"Dan Vanderkam"),g.createElement(r.Z,{value:4},"Boris Cherny"),g.createElement(r.Z,{value:5},"Samer Buna"))),g.createElement(o.Z,null,g.createElement(N.Z,{onClick:x,variant:"contained"},E?"\u63d0\u4ea4":"Submit"))),g.createElement(d.Z,{open:T,onClose:Z},g.createElement(c.Z,null,E?"\u4fe1\u606f":"Info"),g.createElement(u.Z,null,g.createElement(h.Z,null,E?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect")),g.createElement(k.Z,null,g.createElement(N.Z,{onClick:Z},"\u5173\u95ed"))))}))},32102:(e,t,n)=>{n.d(t,{s:()=>h});var a=n(83117),o=n(67294),i=n(42293),r=n(50657),l=n(6514),s=n(54776),p=n(10155),m=n(15861),d=n(93946),c=n(9137),u=n(61274),k=n(50594);const h=(0,o.memo)((e=>{let{open:t,fullScreen:n=!1,title:a,maxWidth:s="md",onClose:h,children:g}=e;const[b,f]=(0,o.useState)(n),y=(0,o.useCallback)((()=>{f((e=>!e))}),[]);return o.createElement(r.Z,{open:t,onClose:h,fullScreen:b,TransitionComponent:N,maxWidth:s},o.createElement(i.Z,{sx:{position:"relative"}},o.createElement(p.Z,null,o.createElement(m.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div"},a),o.createElement(d.Z,{onClick:y,style:{color:"white"}},b?o.createElement(u.Z,null):o.createElement(c.Z,null)),o.createElement(d.Z,{"aria-label":"close",onClick:h,style:{color:"white"}},o.createElement(k.Z,null)))),o.createElement(l.Z,null,g))})),N=o.forwardRef((function(e,t){return o.createElement(s.Z,(0,a.Z)({direction:"up",ref:t},e))}))},39511:(e,t,n)=>{n.d(t,{b:()=>r});var a=n(67294),o=n(83321),i=n(32102);const r=(0,a.memo)((e=>{let{buttonText:t,fullScreen:n=!1,title:r=t,variant:l="outlined",maxWidth:s,useOriginalText:p=!0,children:m}=e;const[d,c]=(0,a.useState)(!1),u=(0,a.useCallback)((e=>{c(!0),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),[]),k=(0,a.useCallback)((()=>{c(!1)}),[]),h=p?{textTransform:"none"}:{};return a.createElement(a.Fragment,null,a.createElement(o.Z,{"data-is-view-more-button":"true",onClick:u,variant:l,size:"small",style:h},t),a.createElement(i.s,{open:d,onClose:k,title:r,maxWidth:s,fullScreen:n},m))}))},53143:(e,t,n)=>{n.d(t,{S:()=>o});var a=n(52263);function o(){const{i18n:e}=(0,a.Z)(),t=e.currentLocale;return"zh"===t||"zh_cn"===t||"zh_CN"==t}},5455:(e,t,n)=>{n.d(t,{ZP:()=>r});var a=n(83117),o=(n(67294),n(3905));const i={toc:[]};function r(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},i,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"There are 5 modes for dissociating child objects "),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Name"),(0,o.kt)("th",null,"Description"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("p",null,"NONE\n",(0,o.kt)("em",{parentName:"p"},"(default)"))),(0,o.kt)("td",null,(0,o.kt)("p",null,"Depend on the global configuration ",(0,o.kt)("a",{parentName:"p",href:"/docs/configuration/dissociate-action-checking"},"jimmer.default-dissociate-action-checking"),". "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If ",(0,o.kt)("a",{parentName:"p",href:"/docs/configuration/dissociate-action-checking"},"jimmer.default-dissociate-action-checking")," is true ",(0,o.kt)("em",{parentName:"p"},"(default)")," or the foreign key underlying the current association is real ",(0,o.kt)("em",{parentName:"p"},"(there is a corresponding foreign key constraint in the database, please refer to ",(0,o.kt)("a",{parentName:"em",href:"/docs/mapping/base/foreignkey"},"Real and Fake Foreign Keys"),")"),",\nit is treated as CHECK. ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If ",(0,o.kt)("a",{parentName:"p",href:"/docs/configuration/dissociate-action-checking"},"jimmer.default-dissociate-action-checking")," is false and the foreign key underlying the current association is fake ",(0,o.kt)("em",{parentName:"p"},"(there is no corresponding foreign key constraint in the database, please refer to ",(0,o.kt)("a",{parentName:"em",href:"/docs/mapping/base/foreignkey"},"Real and Fake Foreign Keys"),")"),", "),(0,o.kt)("p",{parentName:"li"},"it is treated as LAX. "))))),(0,o.kt)("tr",null,(0,o.kt)("td",null,"LAX"),(0,o.kt)("td",null,(0,o.kt)("p",null,"This option is only valid for pseudo foreign keys ",(0,o.kt)("em",{parentName:"p"},"(please refer to ",(0,o.kt)("a",{parentName:"em",href:"/docs/mapping/base/foreignkey"},"Real and Fake Foreign Keys"),")"),",\notherwise it will be ignored, the same as CHECK. "),(0,o.kt)("p",null,"Dissociation operations are supported even if there are child objects.\nEven if the parent object is deleted ",(0,o.kt)("em",{parentName:"p"},"(dissociation mode is also adopted by delete commands)"),",\ndangling pseudo foreign keys of child objects are allowed\n",(0,o.kt)("em",{parentName:"p"},"(even if pseudo foreign keys are left dangling, the query system can still work normally)"),". "))),(0,o.kt)("tr",null,(0,o.kt)("td",null,"CHECK"),(0,o.kt)("td",null,"If there are child objects, disassociation is not supported, the operation is prevented by throwing an exception.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,"SET_NULL"),(0,o.kt)("td",null,"Set the foreign key of the disassociated child object to null. The prerequisite is that the many-to-one associated propety of the child object is nullable; otherwise, attempting this configuration will lead to an exception.")),(0,o.kt)("tr",null,(0,o.kt)("td",null,"DELETE"),(0,o.kt)("td",null,"Delete the disassociated child objects.")))))}r.isMDXComponent=!0},47232:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>k,contentTitle:()=>c,default:()=>g,frontMatter:()=>d,metadata:()=>u,toc:()=>h});var a=n(83117),o=(n(67294),n(3905)),i=n(65488),r=n(85162),l=n(20036),s=n(86153),p=n(39511),m=n(5455);const d={sidebar_position:5,title:"Dissociation Operations"},c=void 0,u={unversionedId:"mutation/save-command/dissociation",id:"mutation/save-command/dissociation",title:"Dissociation Operations",description:"An important concept is involved when saving associated objects: dissociation operations.",source:"@site/docs/mutation/save-command/dissociation.mdx",sourceDirName:"mutation/save-command",slug:"/mutation/save-command/dissociation",permalink:"/jimmer-doc/docs/mutation/save-command/dissociation",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/mutation/save-command/dissociation.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5,title:"Dissociation Operations"},sidebar:"tutorialSidebar",previous:{title:"Save Associations",permalink:"/jimmer-doc/docs/mutation/save-command/association"},next:{title:"Associated Id Checking",permalink:"/jimmer-doc/docs/mutation/save-command/id-checking"}},k={},h=[{value:"Concept",id:"concept",level:2},{value:"Dissociating Middle Table Data",id:"dissociating-middle-table-data",level:2},{value:"Dissociating Child Table Data",id:"dissociating-child-table-data",level:2},{value:"Dissociation Modes",id:"dissociation-modes",level:3},{value:"Example",id:"example",level:3}],N={toc:h};function g(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},N,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"An important concept is involved when saving associated objects: dissociation operations."),(0,o.kt)("h2",{id:"concept"},"Concept"),(0,o.kt)("p",null,"Consider the following example:"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Existing data structure in database"),(0,o.kt)("th",null,"Data structure user wants to save"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Food\n|\n|\n|\n# highlight-next-line\n+-----Meat(Ignore child nodes)\n|\n\\-----Bread(Ignore child nodes)\n"))),(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Food\n|\n+-----Drinks(Ignore child nodes)\n|\n|\n|\n\\-----Bread(Ignore child nodes)\n")))))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"Bread"),", it exists in both old and new data structures, corresponding to update operation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"Drinks"),", it does not exist in the old data structure, but exists in the new data, corresponding to INSERT operation")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"Meat"),", it exists in the old data structure, but does not exist in the new data, the corresponding operation is called dissociation operation."))),(0,o.kt)("p",null,"Dissociation applies to two types of data:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Middle table data")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Child table data"))),(0,o.kt)("p",null,"Next, we discuss these two dissociation operations."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"To simplify the generated SQL as much as possible, let us focus on the association itself and dissociation operations in this article:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"All saved objects specify only the id property ",(0,o.kt)("em",{parentName:"p"},"(short association)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The save mode of the aggregated root object is explicitly specified as UPDATE_ONLY ",(0,o.kt)("em",{parentName:"p"},"(This article uses the syntax of calling the ",(0,o.kt)("inlineCode",{parentName:"em"},"update")," method)"))))),(0,o.kt)("h2",{id:"dissociating-middle-table-data"},"Dissociating Middle Table Data"),(0,o.kt)("p",null,"There is a many-to-many association between the ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK")," table and the ",(0,o.kt)("inlineCode",{parentName:"p"},"AUTHOR")," table, with middle table ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_AUTHOR_MAPPING"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author.books")," properties both map this many-to-many association and are mirrors of each other. Using either can demonstrate the effect. Here we choose ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors"),"."),(0,o.kt)("p",null,"First query the database to see which ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," objects id=3 ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," corresponds to: "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select *  \nfrom book_author_mapping\nwhere book_id = 3;\n")),(0,o.kt)("p",null,"The query result is:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"book_id"),(0,o.kt)("th",{parentName:"tr",align:null},"author_id"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"1")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"2")))),(0,o.kt)("p",null,"Now update this ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," object:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient.update(\n    Objects.createBook(draft -> {\n        draft.setId(3L);\n        draft.addIntoAuthors(author -> author.setId(2L));\n        draft.addIntoAuthors(author -> author.setId(5L));\n    })\n);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient.update(\n    new(Book::class).by {\n        id = 3L\n        authors().addBy { id = 2L } \n        authors().addBy { id = 3L }\n    }\n)\n")))),(0,o.kt)("p",null,"The comparison of old and new data structures is:"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Existing data structure in database"),(0,o.kt)("th",null,"Data structure user wants to save"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Book(id=3)\n| \n# highlight-next-line\n+-----Author(id=1)\n|\n\\-----Author(id=2)\n\n\n"))),(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-Book(id=3)\n|\n|\n|\n+-----Author(id=2)\n|\n\\-----Author(id=5) \n")))))),(0,o.kt)("p",null,"This means:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-2")," remains unchanged")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-5")," needs to be created")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-1")," needs to be deleted, which is the dissociation operation"))),(0,o.kt)("p",null,"Finally 3 SQL statements are generated:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Query which ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," objects ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," corresponds to"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select \n    AUTHOR_ID  \nfrom BOOK_AUTHOR_MAPPING \nwhere\n    BOOK_ID = ? /* 3 */\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Dissociation operation, detach association between ",(0,o.kt)("inlineCode",{parentName:"strong"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"strong"},"Author-1")),"  "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"/* highlight-next-line */\ndelete from BOOK_AUTHOR_MAPPING  \nwhere\n    (BOOK_ID, AUTHOR_ID) in (\n        (? /* 3 */, ? /* 1 */)\n    )\n")),(0,o.kt)("admonition",{parentName:"li",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This is the deassociation operation we want on the middle table"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-3")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author-5")),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"insert into BOOK_AUTHOR_MAPPING(\n    BOOK_ID, AUTHOR_ID \n)\nvalues\n    (? /* 3 */, ? /* 5 */)\n")))),(0,o.kt)("h2",{id:"dissociating-child-table-data"},"Dissociating Child Table Data"),(0,o.kt)("p",null,"This operation is for associations directly based on foreign keys."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK")," table has a foreign key field ",(0,o.kt)("inlineCode",{parentName:"p"},"STORE_ID")," pointing to the ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_STORE")," table, forming a many-to-one association. This many-to-one association is mapped to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store")," property, and the reverse one-to-many association is mapped to the ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")," property."),(0,o.kt)("p",null,"If a parent object in the database ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"BookStore")," in this example)")," holds some child objects ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"Book")," in this example)"),", but the overwritten parent object is no longer expected to continue holding some child objects, it will cause those child objects to be dissociated."),(0,o.kt)("h3",{id:"dissociation-modes"},"Dissociation Modes"),(0,o.kt)(m.ZP,{mdxType:"DissociateMode"}),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Although child object dissociation is caused by a one-to-many association ",(0,o.kt)("em",{parentName:"p"},"(i.e. parent object abandoning some child objects, the one-to-many association is ",(0,o.kt)("inlineCode",{parentName:"em"},"BookStore.books")," in this example)"),", the dissociation mode is configured for the reverse many-to-one association ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"Book.store")," in this example)"),". The purpose of this design is to maintain similarity with configuring cascade behaviors of foreign keys in database DDL. "),(0,o.kt)("p",{parentName:"admonition"},"For Jimmer, a one-to-many association must be bidirectional, so once a one-to-many association is known, its mirroring many-to-one association must also be known. So there is no problem with this design.  ")),(0,o.kt)("p",null,"There are two ways to configure the dissociation mode:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Static configuration on entity with annotation, static configuration is global.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Dynamic configuration in code, dynamic configuration only affects the current save command, and it can override static configuration."))),(0,o.kt)("p",null,"Take ",(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL")," as an example:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Static configuration ",(0,o.kt)("em",{parentName:"p"},"(default configuration, for the vast majority of business uses)"),":"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    //highlight-next-line \n    @OnDissociate(DissociateAction.SET_NULL)  \n    @Nullable\n    @ManyToOne\n    BookStore store();\n\n    ...other code omitted...\n}\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    //highlight-next-line\n    @OnDissociate(DissociateAction.SET_NULL)\n    @ManyToOne  \n    val store: BookStore?\n\n    ...other code omitted...       \n}\n"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Runtime override ",(0,o.kt)("em",{parentName:"p"},"(only for a single save command, used by very few business cases with special needs)"),":"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient\n    .getEntities()\n    .saveCommand(book) \n    // highlight-next-line\n    .setDissociateAction(BookProps.STORE, DissociateAction.SET_NULL)\n    .execute();\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient.save(book) {\n    // highlight-next-line\n    .setDissociateAction(Book::store, DissociateAction.SET_NULL) \n}\n")))))),(0,o.kt)("h3",{id:"example"},"Example"),(0,o.kt)("p",null,"First, query the database to see which ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," objects id=2 ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," holds:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select *\nfrom BOOK  \nwhere STORE_ID = 2\n")),(0,o.kt)("p",null,"The query result is:"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"ID"),(0,o.kt)("th",{parentName:"tr",align:null},"NAME"),(0,o.kt)("th",{parentName:"tr",align:null},"EDITION"),(0,o.kt)("th",{parentName:"tr",align:null},"PRICE"),(0,o.kt)("th",{parentName:"tr",align:null},"STORE_ID"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"12"),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQL in Action"),(0,o.kt)("td",{parentName:"tr",align:null},"3"),(0,o.kt)("td",{parentName:"tr",align:null},"80.00"),(0,o.kt)("td",{parentName:"tr",align:null},"2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"11"),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQL in Action"),(0,o.kt)("td",{parentName:"tr",align:null},"2"),(0,o.kt)("td",{parentName:"tr",align:null},"81.00"),(0,o.kt)("td",{parentName:"tr",align:null},"2")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"10"),(0,o.kt)("td",{parentName:"tr",align:null},"GraphQL in Action"),(0,o.kt)("td",{parentName:"tr",align:null},"1"),(0,o.kt)("td",{parentName:"tr",align:null},"80.00"),(0,o.kt)("td",{parentName:"tr",align:null},"2")))),(0,o.kt)("p",null,"As you can see, ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," holds ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),"."),(0,o.kt)("p",null,"Now, update this ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," object:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient.update(\n    Objects.createBookStore(draft -> {\n        draft.setId(2L);\n        draft.addIntoBooks(book -> book.setId(9L));\n        draft.addIntoBooks(book -> book.setId(10L)); \n    })\n);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient.update(\n    new(BookStore::class).by {\n        id = 2L\n        books().addBy { id = 9L }\n        books().addBy { id = 10L }\n    }\n)\n")))),(0,o.kt)("p",null,"The comparison of old and new data structures is:"),(0,o.kt)("table",null,(0,o.kt)("thead",null,(0,o.kt)("tr",null,(0,o.kt)("th",null,"Existing data structure in database"),(0,o.kt)("th",null,"Data structure user wants to save"))),(0,o.kt)("tbody",null,(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-BookStore(id=2) \n|\n+-----Book(id=10)\n| \n# highlight-next-line\n+-----Book(id=11)\n|\n# highlight-next-line\n\\-----Book(id=12)\n\n\n"))),(0,o.kt)("td",null,(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"+-BookStore(id=2)\n|\n+-----Book(id=10)\n|\n|\n|\n|\n|\n\\-----Book(id=9)\n")))))),(0,o.kt)("p",null,"This means:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10")," remains unchanged")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The association between ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-9")," needs to be created  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," needs to dissociate ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),"."),(0,o.kt)("p",{parentName:"li"},"However, the SQL operations determined by the dissociation mode of the configuration of ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store")," property is unkown."))),(0,o.kt)("p",null,"Different dissociation mode configurations will lead to different execution logic. Next, we discuss the three cases of ",(0,o.kt)("inlineCode",{parentName:"p"},"NONE"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"DELETE"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"NONE")," ",(0,o.kt)("em",{parentName:"p"},"(default)"),":"),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"NONE")," means dissociation is not supported, the operation is prevented by throwing an exception which causes transaction rollback. So the above code will throw an exception."),(0,o.kt)("p",{parentName:"li"},"The exception type is ",(0,o.kt)("inlineCode",{parentName:"p"},"org.babyfish.jimmer.sql.runtime.SaveException"),"."),(0,o.kt)("p",{parentName:"li"},"The exception message is:"),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},'Save error caused by the path: "',"<","root",">",'.books": Cannot dissociate child objects because the dissociation action of the many-to-one property "com.yourcompany.yourproject.model.Book.store" is not configured as "set null" or "cascade". There are two ways to resolve this issue: Decorate the many-to-one property "com.yourcompany.yourproject.model.Book.store" by @org.babyfish.jimmer.sql.OnDissociate whose argument is ',(0,o.kt)("inlineCode",{parentName:"p"},"DissociateAction.SET_NULL")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"DissociateAction.DELETE")," , or use save command's runtime configuration to override it"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL"),":"),(0,o.kt)("p",{parentName:"li"},"In this mode, two SQL statements are generated:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Associate ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-9")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10"),". For ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10")," this is effectively no change."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK  \nset\n    STORE_ID = ? /* 2 */ \nwhere\n    ID in (\n        ? /* 9 */, ? /* 10 */\n    )\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Set foreign key of all books belonging to ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," whose id is not 9 or 10 ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)("inlineCode",{parentName:"em"},"Book-11")," and `",(0,o.kt)("inlineCode",{parentName:"em"},"Book-11")," in this example)")," to empty. "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK\nset\n    STORE_ID = null\nwhere \n    STORE_ID = ? /* 2 */\n    and \n    ID not in ( /* Note `not` */\n        ? /* 9 */, ? /* 10 */\n    )\n")),(0,o.kt)("admonition",{parentName:"li",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Note the ",(0,o.kt)("inlineCode",{parentName:"p"},"not")," in SQL, this is the deassociation operation on the child table for the ",(0,o.kt)("inlineCode",{parentName:"p"},"SET_NULL")," mode. "))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"DELETE"),":"),(0,o.kt)("p",{parentName:"li"},"In this mode, 4 SQL statements are generated:"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Associate ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," with ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-9")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10"),". For ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-10")," this is effectively no change."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK\nset\n    STORE_ID = ? /* 2 */\nwhere\n    ID in (\n        ? /* 9 */, ? /* 10 */  \n    )\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Query all books belonging to ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore-2")," whose id is not 9 or 10. For this example, the query result is ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and `",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),"."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    ID\nfrom BOOK\nwhere\n    STORE_ID = ? /* 2 */\n    and\n    ID not in (\n        ? /* 9 */, ? /* 10 */\n    ) \n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Note the ",(0,o.kt)("inlineCode",{parentName:"p"},"not")," in the SQL"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Before deleting ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12"),", first clean up their many-to-many associations with ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," "),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"delete from BOOK_AUTHOR_MAPPING\nwhere\n    BOOK_ID in (\n        ? /* 11 */, ? /* 12 */\n    )\n")),(0,o.kt)("admonition",{parentName:"li",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," type has more other associations, Jimmer will clean them all up properly. It just means more SQL statements like this step."))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Finally, safely delete ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-11")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book-12")," to complete the dissociation operation"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"delete from BOOK\nwhere\n    ID in (\n        ? /* 11 */, ? /* 12 */\n    )\n")))),(0,o.kt)("admonition",{parentName:"li",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Step 3 and step 4 are a whole, they jointly form the deassociation operation. "),(0,o.kt)("p",{parentName:"admonition"},"In fact, this is the ",(0,o.kt)("a",{parentName:"p",href:"../delete-command"},"Delete Command")," that will be introduced in subsequent documentation. ")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"This article simplifies the examples a lot, such as:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Explicitly specifying processing mode of aggregated root object as ",(0,o.kt)("inlineCode",{parentName:"p"},"UPDATE_ONLY")," ",(0,o.kt)("em",{parentName:"p"},"(calling ",(0,o.kt)("inlineCode",{parentName:"em"},"update")," instead of ",(0,o.kt)("inlineCode",{parentName:"em"},"save"),")"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"All associated objects are short associated objects with only id. In fact, you can arbitrarily change the format of associated objects, for example:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Do not specify ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," property, but specify ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," property ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)(p.b,{buttonText:"Short Association",mdxType:"ViewMore"},(0,o.kt)(l.k,{mdxType:"ShortAssociation"}))," expressed in another way)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Specify ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," property and some properties that are neither ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," nor ",(0,o.kt)("inlineCode",{parentName:"p"},"key")," ",(0,o.kt)("em",{parentName:"p"},"(",(0,o.kt)(p.b,{buttonText:"Long Association",mdxType:"ViewMore"},(0,o.kt)(s._,{mdxType:"LongAssociation"})),")")," "))))),(0,o.kt)("p",{parentName:"admonition"},"The examples are so simplified in this article just to keep the SQL generated by the save command as simple as possible for readers to quickly understand the characteristics of dissociation operations."),(0,o.kt)("p",{parentName:"admonition"},"As for associated objects of more complex formats, readers can try it themselves, or refer directly to the official examples ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/babyfish-ct/jimmer-examples/tree/main/java/save-command"},"jimmer-examples/java/save-command")," and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/babyfish-ct/jimmer-examples/tree/main/kotlin/save-command-kt"},"jimmer-examples/kotlin/save-command-kt"),". These functionalities still exist, just with more generated SQL statements and more tedious hidden details.")))}g.isMDXComponent=!0}}]);