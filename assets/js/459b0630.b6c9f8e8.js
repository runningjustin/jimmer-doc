(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[4028],{64938:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.createSvgIcon}});var o=n(33875)},93946:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Z});var o=n(80102),a=n(83117),i=n(67294),r=n(93680),l=n(94780),s=n(41796),c=n(90948),d=n(71657),u=n(74976),m=n(98216),p=n(1588),g=n(34867);function v(e){return(0,g.Z)("MuiIconButton",e)}const h=(0,p.Z)("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]);var k=n(85893);const b=["edge","children","className","color","disabled","disableFocusRipple","size"],f=(0,c.ZP)(u.Z,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,"default"!==n.color&&t[`color${(0,m.Z)(n.color)}`],n.edge&&t[`edge${(0,m.Z)(n.edge)}`],t[`size${(0,m.Z)(n.size)}`]]}})((({theme:e,ownerState:t})=>(0,a.Z)({textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(e.vars||e).palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest})},!t.disableRipple&&{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,s.Fq)(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})),(({theme:e,ownerState:t})=>{var n;const o=null==(n=(e.vars||e).palette)?void 0:n[t.color];return(0,a.Z)({},"inherit"===t.color&&{color:"inherit"},"inherit"!==t.color&&"default"!==t.color&&(0,a.Z)({color:null==o?void 0:o.main},!t.disableRipple&&{"&:hover":(0,a.Z)({},o&&{backgroundColor:e.vars?`rgba(${o.mainChannel} / ${e.vars.palette.action.hoverOpacity})`:(0,s.Fq)(o.main,e.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),"small"===t.size&&{padding:5,fontSize:e.typography.pxToRem(18)},"large"===t.size&&{padding:12,fontSize:e.typography.pxToRem(28)},{[`&.${h.disabled}`]:{backgroundColor:"transparent",color:(e.vars||e).palette.action.disabled}})})),Z=i.forwardRef((function(e,t){const n=(0,d.Z)({props:e,name:"MuiIconButton"}),{edge:i=!1,children:s,className:c,color:u="default",disabled:p=!1,disableFocusRipple:g=!1,size:h="medium"}=n,Z=(0,o.Z)(n,b),y=(0,a.Z)({},n,{edge:i,color:u,disabled:p,disableFocusRipple:g,size:h}),C=(e=>{const{classes:t,disabled:n,color:o,edge:a,size:i}=e,r={root:["root",n&&"disabled","default"!==o&&`color${(0,m.Z)(o)}`,a&&`edge${(0,m.Z)(a)}`,`size${(0,m.Z)(i)}`]};return(0,l.Z)(r,v,t)})(y);return(0,k.jsx)(f,(0,a.Z)({className:(0,r.Z)(C.root,c),centerRipple:!0,focusRipple:!g,disabled:p,ref:t,ownerState:y},Z,{children:s}))}))},33875:(e,t,n)=>{"use strict";n.r(t),n.d(t,{capitalize:()=>a.Z,createChainedFunction:()=>i,createSvgIcon:()=>r.Z,debounce:()=>l.Z,deprecatedPropType:()=>s,isMuiElement:()=>c.Z,ownerDocument:()=>d.Z,ownerWindow:()=>u.Z,requirePropFactory:()=>m,setRef:()=>p,unstable_ClassNameGenerator:()=>y,unstable_useEnhancedEffect:()=>g.Z,unstable_useId:()=>v,unsupportedProp:()=>h,useControlled:()=>k.Z,useEventCallback:()=>b.Z,useForkRef:()=>f.Z,useIsFocusVisible:()=>Z.Z});var o=n(37078),a=n(98216);const i=n(49064).Z;var r=n(88169),l=n(57144);const s=function(e,t){return()=>null};var c=n(71579),d=n(8038),u=n(5340);n(83117);const m=function(e,t){return()=>null};const p=n(7960).Z;var g=n(58974);const v=n(92996).Z;const h=function(e,t,n,o,a){return null};var k=n(72021),b=n(2068),f=n(51705),Z=n(18791);const y={configure:e=>{o.Z.configure(e)}}},86153:(e,t,n)=>{"use strict";n.d(t,{_:()=>B});var o=n(67294),a=n(87357),i=n(83321),r=n(61903),l=n(23599),s=n(86886),c=n(67720),d=n(90629),u=n(7906),m=n(295),p=n(53252),g=n(72882),v=n(53184),h=n(53816),k=n(24661),b=n(96540),f=n(93946),Z=n(41733),y=n(50657),C=n(31425),S=n(6514),I=n(58951),w=n(37645),N=n(52263),E=n(59457),x=n(53143);const B=(0,o.memo)((()=>{const{i18n:e}=(0,N.Z)(),t=(0,x.S)(),n=(0,o.useMemo)((()=>t?T:_),[t]),B=(0,o.useMemo)((()=>{const e=new Map;for(const t of n)e.set(t.id,t);return e}),[n]),z=(0,o.useMemo)((()=>t?q:L),[t]),A=(0,o.useMemo)((()=>{const e=new Map;for(const t of z)e.set(t.id,t);return e}),[z]),[M,j]=(0,E.x)((()=>({userId:1,province:B.get(1).province,city:B.get(1).city,address:B.get(1).address,items:[{__rowId:1,productId:1,name:A.get(1).name,quantity:2},{__rowId:2,productId:10,name:A.get(10).name,quantity:1}]}))),W=(0,o.useMemo)((()=>Math.max(...M.items.map((e=>e.__rowId)))+1),[M]),R=(0,o.useCallback)((e=>{const t=B.get(parseInt(e.target.value));void 0!==t&&j((e=>{e.userId=t.id,e.province=t.province,e.city=t.city,e.address=t.address}))}),[j,B]),O=(0,o.useCallback)((e=>{j((t=>{t.province=e.target.value}))}),[j]),D=(0,o.useCallback)((e=>{j((t=>{t.city=e.target.value}))}),[j]),F=(0,o.useCallback)((e=>{j((t=>{t.address=e.target.value}))}),[j]),$=(0,o.useCallback)(((e,t)=>{j((n=>{for(const o of n.items)if(o.__rowId===t){o.productId=parseInt(e.target.value),P(n);break}}))}),[j]),G=(0,o.useCallback)(((e,t)=>{j((n=>{for(const o of n.items)if(o.__rowId===t){o.quantity=parseInt(e.target.value),P(n);break}}))}),[j]),J=(0,o.useCallback)((e=>{j((t=>{for(let n=t.items.length-1;n>=0;--n)if(t.items[n].__rowId===e){t.items.splice(n,1);break}}))}),[j]),U=(0,o.useCallback)((()=>{j((e=>{e.items.push({__rowId:W,quantity:1})}))}),[j,W]),[K,V]=(0,o.useState)(!1),X=(0,o.useCallback)((()=>{V(!0)}),[]),Q=(0,o.useCallback)((()=>{V(!1)}),[]);return o.createElement(d.Z,{elevation:3,style:{padding:"1.5rem"}},o.createElement(a.Z,{component:"form",noValidate:!0,autoComplete:"off"},o.createElement(s.ZP,{container:!0,spacing:2},o.createElement(s.ZP,{item:!0,xs:4},o.createElement(r.Z,{fullWidth:!0,select:!0,label:t?"\u8d2d\u4e70\u4eba":"Purchaser",value:M.userId,onChange:R},n.map((e=>o.createElement(l.Z,{key:e.id,value:e.id},e.nickName))))),o.createElement(s.ZP,{item:!0,xs:4},o.createElement(r.Z,{fullWidth:!0,label:t?"\u7701\u4efd":"Province",value:M.province,onChange:O})),o.createElement(s.ZP,{item:!0,xs:4},o.createElement(r.Z,{fullWidth:!0,label:t?"\u57ce\u5e02":"City",value:M.city,onChange:D})),o.createElement(s.ZP,{item:!0,xs:12},o.createElement(r.Z,{fullWidth:!0,label:t?"\u5730\u5740":"Address",value:M.address,onChange:F})),o.createElement(s.ZP,{item:!0,xs:12},o.createElement(c.Z,{textAlign:"left"},t?"\u8ba2\u5355\u660e\u7ec6":"Order Items"),o.createElement(g.Z,{component:d.Z},o.createElement(u.Z,{size:"small"},o.createElement(v.Z,null,o.createElement(h.Z,null,o.createElement(p.Z,null,t?"\u5546\u54c1":"Commodity"),o.createElement(p.Z,null,t?"\u6570\u91cf":"Quantity"),o.createElement(p.Z,null,t?"\u5355\u4ef7":"Unit price"),o.createElement(p.Z,null,t?"\u660e\u7ec6\u4ef7":"Item price"),o.createElement(p.Z,null,t?"\u5220\u9664":"Delete"))),o.createElement(m.Z,null,M.items.map((e=>{const t=void 0!==e.productId?A.get(e.productId):void 0;return o.createElement(h.Z,{key:e.__rowId},o.createElement(p.Z,null,o.createElement(r.Z,{select:!0,value:null==t?void 0:t.id,variant:"standard",size:"small",onChange:t=>{$(t,e.__rowId)}},z.map((e=>o.createElement(l.Z,{key:e.id,value:e.id},e.name))))),o.createElement(p.Z,null,o.createElement(r.Z,{type:"number",value:e.quantity,variant:"standard",size:"small",onChange:t=>{G(t,e.__rowId)}})),o.createElement(p.Z,null,null==t?void 0:t.price),o.createElement(p.Z,null,void 0!==t&&t.price*e.quantity),o.createElement(p.Z,null,o.createElement(f.Z,{onClick:()=>J(e.__rowId)},o.createElement(Z.Z,null))))}))),o.createElement(k.Z,null,o.createElement(h.Z,null,o.createElement(p.Z,{colSpan:5},o.createElement(i.Z,{onClick:U},o.createElement(b.Z,null),t?"\u6dfb\u52a0":"Add"))))))),o.createElement(s.ZP,{item:!0,xs:12},t?"\u603b\u989d":"Total price",":",M.items.filter((e=>void 0!==e.productId&&"number"==typeof e.quantity)).map((e=>A.get(e.productId).price*e.quantity)).reduce(((e,t)=>e+t),0)),o.createElement(s.ZP,{item:!0,xs:12},o.createElement(i.Z,{variant:"contained",onClick:X},t?"\u63d0\u4ea4":"Submit")))),o.createElement(y.Z,{open:K,onClose:Q},o.createElement(w.Z,null,t?"\u4fe1\u606f":"Info"),o.createElement(S.Z,null,o.createElement(I.Z,null,t?"\u4ec5\u4f5c\u793a\u8303\uff0c\u65e0\u4efb\u4f55\u6548\u679c":"For demonstration only, without any effect")),o.createElement(C.Z,null,o.createElement(i.Z,{onClick:Q},t?"\u5173\u95ed":"Close"))))})),T=[{id:1,nickName:"\u76ae\u76ae\u9c81",province:"\u56db\u5ddd",city:"\u6210\u90fd",address:"\u9f99\u6cc9\u9a7f\u533a\u6d2a\u7389\u8def\u4e0e\u5341\u6d2a\u8def\u4ea4\u53c9\u53e3"},{id:2,nickName:"\u9c81\u897f\u897f",province:"\u5e7f\u4e1c",city:"\u5e7f\u5dde",address:"\u767d\u4e91\u533a\u77f3\u6c99\u8def300\u53f7"},{id:3,nickName:"\u8212\u514b",province:"\u897f\u85cf",city:"\u62c9\u8428",address:"\u5806\u9f99\u5fb7\u5e86\u533a"},{id:4,nickName:"\u8d1d\u5854",province:"\u4e0a\u6d77",city:"\u4e0a\u6d77",address:"\u6d66\u4e1c\u65b0\u533a\u79c0\u6cbf\u897f\u8def218\u5f04"}],_=[{id:1,nickName:"Schneewittchen",province:"Berlin",city:"Prenzlauer Berg",address:"Brandenburgische Stra\xdfe 9, Prenzlauer Berg, Berlin, Germany"},{id:2,nickName:"Cinderella",province:"Basse-Normandie",city:"Lisieux",address:"20 rue L\xe9on Dierx, Lisieux, Basse-Normandie, France"},{id:3,nickName:"Nuwa",province:"ShanXi",city:"Taiyuan",address:"Qian Feng Nan Lu 99hao, Taiyuan, ShanXi, China"},{id:4,nickName:"Pinocchio",province:"Palazzo Pignano",city:"Cremona",address:"Via Giovanni Amendola 134, Palazzo Pignano, Cremona, Italy"}],q=[{id:1,name:"zippo\u591c\u5149\u6d41\u6c99\u6253\u706b\u673a",price:268},{id:2,name:"\u6770\u767b(Jayden)\u5370\u5ea6\u5854\u5e03\u62c9\u9f13",price:9238},{id:3,name:"\u6d6a\u7434(Longines)\u673a\u68b0\u624b\u8868",price:13900},{id:4,name:"viney\u7537\u58eb\u76ae\u5e26",price:139},{id:5,name:"\u96c5\u8bd7\u5170\u9edb\u7ed2\u96fe\u54d1\u5149\u5507\u818f",price:310},{id:6,name:"CIRCUIT\u7537\u5b50\u6ed1\u96ea\u5355\u677f",price:2044},{id:7,name:"\u7279\u4ed1\u82cf\u8131\u8102\u725b\u5976",price:47},{id:8,name:"\u4e50\u9ad8\u79ef\u6728\u5e03\u52a0\u8fea",price:374},{id:9,name:"\u53cc\u559c\u71c3\u6c14\u7535\u78c1\u901a\u7528\u538b\u529b\u9505",price:137},{id:10,name:"\u61a8\u61a8\u5ba0\u732b\u722c\u67b6",price:238}],L=[{id:1,name:"Timeless Vitamin C Plus E 10 Percent Ferulic Acid Serum Serum Unisex 1 oz",price:14.69},{id:2,name:"Dockers Men's Tiller Boat Shoe",price:52.41},{id:3,name:"Paxcoo 124 Skeins Embroidery Floss Cross Stitch Thread with Needles",price:29.99},{id:4,name:"Michael Kors Crossbody",price:70.6},{id:5,name:"Crocs unisex-child Classic Graphic Clog",price:34.99},{id:6,name:"Timex Time Machines Digital 35mm Watch",price:28.95},{id:7,name:"Scalex Mite & Lice Spray for Birds, 8 oz.",price:14.75},{id:8,name:"Under Armour Men's Storm Liner",price:13.03},{id:9,name:"Nike Women's Pro 3\" Training Shorts",price:35.86},{id:10,name:"Olaplex No. 4 Bond Maintenance Shampoo",price:30}];function P(e){const t=e.items,n=new Map;for(let o=0;o<t.length;o++){const e=t[o];if("number"!=typeof e.quantity)e.quantity=1;else if(e.quantity<1){t.splice(o--,1);continue}if(void 0===e.productId)continue;const a=n.get(e.productId);void 0===a?n.set(e.productId,e):(a.quantity+=e.quantity,t.splice(o--,1))}}},53143:(e,t,n)=>{"use strict";n.d(t,{S:()=>a});var o=n(52263);function a(){const{i18n:e}=(0,o.Z)(),t=e.currentLocale;return"zh"===t||"zh_cn"===t||"zh_CN"==t}},79659:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>c,default:()=>g,frontMatter:()=>s,metadata:()=>d,toc:()=>m});var o=n(83117),a=(n(67294),n(3905)),i=n(65488),r=n(85162),l=n(86153);const s={sidebar_position:3,title:"Save Long Associations"},c=void 0,d={unversionedId:"quick-view/save/export/long",id:"quick-view/save/export/long",title:"Save Long Associations",description:"What is Long Association",source:"@site/docs/quick-view/save/export/long.mdx",sourceDirName:"quick-view/save/export",slug:"/quick-view/save/export/long",permalink:"/jimmer-doc/docs/quick-view/save/export/long",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/quick-view/save/export/long.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"Save Long Associations"},sidebar:"tutorialSidebar",previous:{title:"Save Short Associations",permalink:"/jimmer-doc/docs/quick-view/save/export/short"},next:{title:"Arbitrary Dynamic Query",permalink:"/jimmer-doc/docs/quick-view/dsl/"}},u={},m=[{value:"What is Long Association",id:"what-is-long-association",level:2},{value:"Write DTO",id:"write-dto",level:2},{value:"Generated Code",id:"generated-code",level:2},{value:"Write HTTP Service",id:"write-http-service",level:2}],p={toc:m};function g(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"what-is-long-association"},"What is Long Association"),(0,a.kt)("p",null,"A long association refers to not only changing the association relationship between the current object and other objects, but also further modifying the associated object.  "),(0,a.kt)("p",null,"For the UI interface, it is usually manifested as nested parent-child forms (or even recursive trees). The forms are diverse, and sub-forms embedded in forms are quite common, as follows:  "),(0,a.kt)(l._,{mdxType:"LongAssociation"}),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"As long as developers are willing, the depth of this nested parent-child form structure can be more than two layers. In theory, the depth can be infinite, which is why it is called a long association.")),(0,a.kt)("h2",{id:"write-dto"},"Write DTO"),(0,a.kt)("p",null,"In the current example in the ",(0,a.kt)("a",{parentName:"p",href:"../../precondition#book"},"entity definition"),", the more suitable example as a long association to save is the ",(0,a.kt)("inlineCode",{parentName:"p"},"BookStore")," and its associated ",(0,a.kt)("inlineCode",{parentName:"p"},"books")," collection.  "),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Install DTO language Intellij plugin: ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ClearPlume/jimmer-dto"},"https://github.com/ClearPlume/jimmer-dto")," ",(0,a.kt)("em",{parentName:"p"},"(This process is not required but highly recommended)"))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create a new directory ",(0,a.kt)("inlineCode",{parentName:"p"},"src/main/dto"),"   ")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Under ",(0,a.kt)("inlineCode",{parentName:"p"},"src/main/dto"),", create a file ",(0,a.kt)("inlineCode",{parentName:"p"},"BookStore.dto")," and write the following code:   "),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-sh",metastring:'title="BookStore.dto"',title:'"BookStore.dto"'},"export org.doc.j.model.BookStore  \n    -> package org.doc.j.model.dto  \n\ninput BookStoreWithLongAssociation {\n    #allScalars(this) \n    #highlight-next-line \n    books { // LongAssociation\n        #allScalars(this)\n        -id\n        id(authors) as authorIds \n    }\n}\n")))),(0,a.kt)("h2",{id:"generated-code"},"Generated Code"),(0,a.kt)("p",null,"After compilation, Jimmer will generate the following code:  "),(0,a.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,a.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookStoreWithLongAssociation.java"',title:'"BookStoreWithLongAssociation.java"'},'@GeneratedBy(\n        file = "<yourproject>/src/main/dto/BookStore.dto"  \n)\npublic class BookStoreWithLongAssociation implements Input<BookStore> {\n\n    @Nullable\n    private Long id;\n\n    @NotNull\n    private String name;   \n\n    @Nullable\n    private String website;\n\n    @NotNull\n    // highlight-next-line\n    private List<TargetOf_books> books;  \n\n    ...Omit other methods...\n\n    public static class TargetOf_books implements Input<Book> {  \n\n        @NotNull \n        private String name;\n\n        private int edition;\n\n        @NotNull\n        private BigDecimal price;\n\n        @NotNull\n        private List<Long> authorIds;\n\n        ...Omit other methods...\n    }  \n}\n'))),(0,a.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookStoreWithLongAssociation.kt"',title:'"BookStoreWithLongAssociation.kt"'},'@GeneratedBy(\n        file = "<yourproject>/src/main/dto/BookStore.dto"  \n)\ndata class BookStoreWithLongAssociation(  \n    val id: Long?\n    val name: String,\n    val website: String?,\n    // highlight-next-line\n    val books: List<TargetOf_books>  \n) : Input<BookStore> {\n    \n    ...Omit other methods...  \n\n    data class TargetOf_authors(  \n        val name: String,\n        val edition: Int, \n        val price: BigDecimal, \n        val authorIds: List<Long>\n    )  \n}\n')))),(0,a.kt)("h2",{id:"write-http-service"},"Write HTTP Service"),(0,a.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,a.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookStoreController.java"',title:'"BookStoreController.java"'},'@RestController  \npublic class BookStoreController {  \n\n    private final JSqlClient sqlClient;\n\n    public BookController(JSqlClient sqlClient) {\n        this.sqlClient = sqlClient; \n    }  \n\n    @PutMapping("/bookStore")\n    pubic int saveBookStoreWithLongAssociation(\n        // highlight-next-line\n        @RequestBody BookStoreWithLongAssociation input\n    ) {\n        return sqlClient\n            .save(input)\n            .getTotoalAffectedRowCount();\n    }\n}\n'))),(0,a.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookStoreController.java"',title:'"BookStoreController.java"'},'class BookStoreController(\n    private val sqlClient: KSqlClient   \n) {  \n\n    @PutMapping("/bookStore")  \n    fun saveBookStoreWithLongAssociation(\n        // highlight-next-line\n        @RequestBody input: BookStoreWithLongAssociation  \n    ): Int =\n        sqlClient\n            .save(input)\n            .totoalAffectedRowCount\n}\n')))),(0,a.kt)("p",null,"It can be seen that no matter how the Input DTO changes, Jimmer still only needs one method call to complete data saving."))}g.isMDXComponent=!0},66344:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports}}]);