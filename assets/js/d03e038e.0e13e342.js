"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[9907],{85162:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(67294),o=a(34334);const r="tabItem_Ymn6";function l(e){let{children:t,hidden:a,className:l}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.Z)(r,l),hidden:a},t)}},65488:(e,t,a)=>{a.d(t,{Z:()=>c});var n=a(83117),o=a(67294),r=a(34334),l=a(72389),i=a(67392),s=a(7094),m=a(12466);const d="tabList__CuJ",p="tabItem_LNqP";function u(e){var t;const{lazy:a,block:l,defaultValue:u,values:c,groupId:k,className:g}=e,h=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=c??h.map((e=>{let{props:{value:t,label:a,attributes:n}}=e;return{value:t,label:a,attributes:n}})),N=(0,i.l)(b,((e,t)=>e.value===t.value));if(N.length>0)throw new Error(`Docusaurus error: Duplicate values "${N.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const v=null===u?u:u??(null==(t=h.find((e=>e.props.default)))?void 0:t.props.value)??h[0].props.value;if(null!==v&&!b.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:f}=(0,s.U)(),[T,I]=(0,o.useState)(v),w=[],{blockElementScrollPositionUntilNextRender:x}=(0,m.o5)();if(null!=k){const e=y[k];null!=e&&e!==T&&b.some((t=>t.value===e))&&I(e)}const E=e=>{const t=e.currentTarget,a=w.indexOf(t),n=b[a].value;n!==T&&(x(t),I(n),null!=k&&f(k,String(n)))},B=e=>{var t;let a=null;switch(e.key){case"ArrowRight":{const t=w.indexOf(e.currentTarget)+1;a=w[t]??w[0];break}case"ArrowLeft":{const t=w.indexOf(e.currentTarget)-1;a=w[t]??w[w.length-1];break}}null==(t=a)||t.focus()};return o.createElement("div",{className:(0,r.Z)("tabs-container",d)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":l},g)},b.map((e=>{let{value:t,label:a,attributes:l}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:T===t?0:-1,"aria-selected":T===t,key:t,ref:e=>w.push(e),onKeyDown:B,onFocus:E,onClick:E},l,{className:(0,r.Z)("tabs__item",p,null==l?void 0:l.className,{"tabs__item--active":T===t})}),a??t)}))),a?(0,o.cloneElement)(h.filter((e=>e.props.value===T))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==T})))))}function c(e){const t=(0,l.Z)();return o.createElement(u,(0,n.Z)({key:String(t)},e))}},32102:(e,t,a)=>{a.d(t,{s:()=>g});var n=a(83117),o=a(67294),r=a(42293),l=a(50657),i=a(6514),s=a(54776),m=a(10155),d=a(15861),p=a(93946),u=a(9137),c=a(61274),k=a(50594);const g=(0,o.memo)((e=>{let{open:t,fullScreen:a=!1,title:n,maxWidth:s="md",onClose:g,children:b}=e;const[N,v]=(0,o.useState)(a),y=(0,o.useCallback)((()=>{v((e=>!e))}),[]);return o.createElement(l.Z,{open:t,onClose:g,fullScreen:N,TransitionComponent:h,maxWidth:s},o.createElement(r.Z,{sx:{position:"relative"}},o.createElement(m.Z,null,o.createElement(d.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div"},n),o.createElement(p.Z,{onClick:y,style:{color:"white"}},N?o.createElement(c.Z,null):o.createElement(u.Z,null)),o.createElement(p.Z,{"aria-label":"close",onClick:g,style:{color:"white"}},o.createElement(k.Z,null)))),o.createElement(i.Z,null,b))})),h=o.forwardRef((function(e,t){return o.createElement(s.Z,(0,n.Z)({direction:"up",ref:t},e))}))},39511:(e,t,a)=>{a.d(t,{b:()=>l});var n=a(67294),o=a(83321),r=a(32102);const l=(0,n.memo)((e=>{let{buttonText:t,fullScreen:a=!1,title:l=t,variant:i="outlined",maxWidth:s,children:m}=e;const[d,p]=(0,n.useState)(!1),u=(0,n.useCallback)((e=>{p(!0),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),[]),c=(0,n.useCallback)((()=>{p(!1)}),[]);return n.createElement(n.Fragment,null,n.createElement(o.Z,{"data-is-view-more-button":"true",onClick:u,variant:i,size:"small"},t),n.createElement(r.s,{open:d,onClose:c,title:l,maxWidth:s,fullScreen:a},m))}))},93351:(e,t,a)=>{a.d(t,{ZP:()=>s});var n=a(83117),o=(a(67294),a(3905)),r=a(65488),l=a(85162);const i={toc:[{value:"1. A few properties",id:"1-a-few-properties",level:2},{value:"2. More Properties",id:"2-more-properties",level:2},{value:"3. Include Association",id:"3-include-association",level:2},{value:"4. More Associations (Larger Breadth)",id:"4-more-associations-larger-breadth",level:2},{value:"5. Deeper Associations (Larger Depth)",id:"5-deeper-associations-larger-depth",level:3}]};function s(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},i,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"1-a-few-properties"},"1. A few properties"),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'Book book = Objects.createBook(draft -> {\n    draft.setName("Learning GraphQL");\n});\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val book = new(Book::class).by {\n    name = "Learning GraphQL"\n}\n')))),(0,o.kt)("p",null,"In this case, the JSON for the ",(0,o.kt)("inlineCode",{parentName:"p"},"books")," object would be like follows"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{"name": "Learning GraphQL"}\n')),(0,o.kt)("h2",{id:"2-more-properties"},"2. More Properties"),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'Book book = Objects.createBook(draft -> {\n    draft.setName("Learning GraphQL");\n    draft.setEdition(1);\n    draft.setPrice(new BigDecimal("49.99"));\n});\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val book = new(Book::class).by {\n    name = "Learning GraphQL"\n    edition = 1\n    price = BigDecimal("49.99")\n}\n')))),(0,o.kt)("p",null,"In this case, the JSON for the ",(0,o.kt)("inlineCode",{parentName:"p"},"books")," object would be like follows"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "Learning GraphQL",\n    "edition": 1,\n    "price": 49.99\n}\n')),(0,o.kt)("h2",{id:"3-include-association"},"3. Include Association"),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'Book book = Objects.createBook(draft -> {\n    draft.setName("Learning GraphQL");\n    draft.setEdition(1);\n    draft.setPrice(new BigDecimal("49.99"));\n    draft.applyStore(store -> {\n        store.setName("O\'REILLY");\n        store.setWebsite("https://www.oreilly.com/");\n    });\n});\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val book = new(Book::class).by {\n    name = "Learning GraphQL"\n    edition = 1\n    price = BigDecimal("49.99")\n    store().apply {\n        name = "O\'REILLY"\n        website = "https://www.oreilly.com/"\n    }\n}\n')))),(0,o.kt)("p",null,"In this case, the JSON for the ",(0,o.kt)("inlineCode",{parentName:"p"},"books")," object would be like follows"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "Learning GraphQL",\n    "edition": 1,\n    "price": 49.99,\n    "store": {\n        "name": "O\'REILLY",\n        "website": "https://www.oreilly.com/"\n    }\n}\n')),(0,o.kt)("h2",{id:"4-more-associations-larger-breadth"},"4. More Associations (Larger Breadth)"),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'Book book = Objects.createBook(draft -> {\n    draft.setName("Learning GraphQL");\n    draft.setEdition(1);\n    draft.setPrice(new BigDecimal("49.99"));\n    draft.applyStore(store -> {\n        store.setName("O\'REILLY");\n        store.setWebsite("https://www.oreilly.com/");\n    });\n    draft.addIntoAuthors(author -> { \n        author.setFirstName("Eve");\n        author.setLastName("Procello");\n        author.setGender(Gender.FEMALE);\n    });\n    draft.addIntoAuthors(author -> { \n        author.setFirstName("Alex");\n        author.setLastName("Banks");\n        author.setGender(Gender.MALE);\n    });\n});\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val book = new(Book::class).by {\n    name = "Learning GraphQL"\n    edition = 1\n    price = BigDecimal("49.99")\n    store().apply {\n        name = "O\'REILLY"\n        website = "https://www.oreilly.com/"\n    }\n    authors().addBy {\n        firstName = "Eve"\n        setLastName = "Procello"\n        gender = Gender.FEMALE\n    }\n    authors().addBy {\n        firstName = "Alex"\n        lastName = "Banks"\n        gender = Gender.MALE\n    }\n}\n')))),(0,o.kt)("p",null,"In this case, the JSON for the ",(0,o.kt)("inlineCode",{parentName:"p"},"books")," object would be like follows"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "Learning GraphQL",\n    "edition": 1,\n    "price": 49.99,\n    "store": {\n        "name": "O\'REILLY",\n        "website": "https://www.oreilly.com/"\n    },\n    "authors": [\n        {\n            "firstName": "Eve",\n            "lastName": "Procello",\n            "gender:" "FEMALE"\n        },\n        {\n            "firstName": "Alex",\n            "lastName": "Banks",\n            "gender:" "MALE"\n        }\n    ]\n}\n')),(0,o.kt)("h3",{id:"5-deeper-associations-larger-depth"},"5. Deeper Associations (Larger Depth)"),(0,o.kt)("p",null,"Here is the translation to English:"),(0,o.kt)("p",null,"Unlike the previous examples, here we choose ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," as the aggregate root for the data structure, rather than ",(0,o.kt)("inlineCode",{parentName:"p"},"Book"),"."),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'BookStore store = Objects.createBookStore(draft -> {\n    draft.setName("O\'REILLY");\n    draft.setWebsite("https://www.oreilly.com/");\n    draft.addIntoBooks(book -> {\n        book.setName("Learning GraphQL");\n        book.setEdition(1);\n        book.setPrice(new BigDecimal("49.99"));\n        book.addIntoAuthors(author -> { \n            author.setFirstName("Eve");\n            author.setLastName("Procello");\n            author.setGender(Gender.FEMALE);\n        });\n        book.addIntoAuthors(author -> { \n            author.setFirstName("Alex");\n            author.setLastName("Banks");\n            author.setGender(Gender.MALE);\n        });\n    });\n});\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val store = new(BookStore::class).by {\n    name = "O\'REILLY"\n    website = "https://www.oreilly.com/"\n    books().addBy {\n        name = "Learning GraphQL"\n        edition = 1\n        price = BigDecimal("49.99")\n        authors().addBy {\n            firstName = "Eve"\n            setLastName = "Procello"\n            gender = Gender.FEMALE\n        }\n        authors().addBy {\n            firstName = "Alex"\n            lastName = "Banks"\n            gender = Gender.MALE\n        }\n    }\n}\n')))),(0,o.kt)("p",null,"In this case, the JSON for the ",(0,o.kt)("inlineCode",{parentName:"p"},"store")," object would be like follows"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "O\'REILLY",\n    "website": "https://www.oreilly.com/",\n    "books": [\n        {\n            "name": "Learning GraphQL",\n            "edition": 1,\n            "price": 49.99,\n            "authors": [\n                {\n                    "firstName": "Eve",\n                    "lastName": "Procello",\n                    "gender:" "FEMALE"\n                },\n                {\n                    "firstName": "Alex",\n                    "lastName": "Banks",\n                    "gender:" "MALE"\n                }\n            ]\n        }\n    ]\n}\n')))}s.isMDXComponent=!0},35892:(e,t,a)=>{a.d(t,{ZP:()=>i});var n=a(83117),o=(a(67294),a(3905)),r=(a(65488),a(85162),a(79554));const l={toc:[]};function i(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'In order to solve the inconvenience of secondary "modification" ',(0,o.kt)("em",{parentName:"p"},"(creating a new immutable object based on another immutable object)")," of complex immutable objects in the current JVM ecosystem, some immutable object frameworks were born:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://immutables.github.io/immutable.html"},"Immutables")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/inferred/FreeBuilder"},"FreeBuilder")," "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://arrow-kt.io/learn/immutable-data/intro/"},"Arrow-Kt(Kotlin)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://kopyk.at/"},"Kopyk(Kotlin)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/PatilShreyas/mutekt"},"MuteKt(Kotlin)"))),(0,o.kt)("p",null,"Jimmer is an ORM framework, and handling deep data structures is a core issue for ORM, so Jimmer must do similar work."),(0,o.kt)("p",null,"Jimmer needs to provide elegant dual language support for both Java and Kotlin at the same time. None of the above solutions can meet this requirement, so Jimmer did not use any of them, but chose to transplant ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/immerjs/immer"},"immer")," from the JavaScript/TypeScript field."),(0,o.kt)(r.ZP,{mdxType:"ImmutableStep"}),"This transplant is a powerful complement to the JVM ecosystem.",(0,o.kt)("p",null,"This framework is named Jimmer, paying tribute to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/immerjs/immer"},"immer"),"."))}i.isMDXComponent=!0},79554:(e,t,a)=>{a.d(t,{ZP:()=>s});var n=a(83117),o=(a(67294),a(3905)),r=a(65488),l=a(85162);const i={toc:[{value:"1. Define immutable type",id:"1-define-immutable-type",level:2},{value:"2. Create data structure from scratch",id:"2-create-data-structure-from-scratch",level:2},{value:"3. Create new data based on existing data",id:"3-create-new-data-based-on-existing-data",level:2}]};function s(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},i,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Next, we will demonstrate the power of immutable objects transplanted from ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/immerjs/immer"},"immer")," in three steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Define immutable types ")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create an immutable data structure from scratch")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Based on an existing data structure, create a new data structure according to some desired modifications. "),(0,o.kt)("blockquote",{parentName:"li"},(0,o.kt)("p",{parentName:"blockquote"},"This last step is where the core value of ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/immerjs/immer"},"immer")," lies. Please pay close attention.")))),(0,o.kt)("h2",{id:"1-define-immutable-type"},"1. Define immutable type"),(0,o.kt)("p",null,"To demonstrate this feature, there is no need for the ",(0,o.kt)("inlineCode",{parentName:"p"},"@Entity")," annotation on ORM entities, the non-ORM ",(0,o.kt)("inlineCode",{parentName:"p"},"@Immutable")," is sufficient."),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="TreeNode.java"',title:'"TreeNode.java"'},"package yourpackage;\n\nimport java.util.List;\nimport org.babyfish.jimmer.Immutable;\n\n@Immutable \npublic interface TreeNode {\n    \n    String name();\n\n    List<TreeNode> childNodes();\n}\n"))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="TreeNode.kt"',title:'"TreeNode.kt"'},"package yourpackage\n\nimport org.babyfish.jimmer.Immutable\n\n@Immutable\ninterface TreeNode {\n\n    val name: String\n\n    val childNodes: List<TreeNode>\n}\n")))),(0,o.kt)("h2",{id:"2-create-data-structure-from-scratch"},"2. Create data structure from scratch"),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'TreeNode treeNode = Objects.createTreeNode(root -> {\n    root.setName("Root").addIntoChildNodes(food -> {\n        food\n            .setName("Food")\n            .addIntoChildNodes(drink -> {\n                drink\n                    .setName("Drink")\n                    .addIntoChildNodes(cococola -> {\n                        cococola.setName("Cococola");\n                    })\n                    .addIntoChildNodes(fanta -> {\n                        fanta.setName("Fanta");\n                    });\n                ;\n            });\n        ;\n    });\n});\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val treeNode = new(TreeNode::class).by {\n    name = "Root"\n    childNodes().addBy {\n        name = "Food"\n        childNodes().addBy {\n            name = "Drinks"\n            childNodes().addBy {\n                name = "Cococola"\n            }\n            childNodes().addBy {\n                name = "Fanta"\n            }\n        }\n    }\n}\n')))),(0,o.kt)("h2",{id:"3-create-new-data-based-on-existing-data"},"3. Create new data based on existing data"),(0,o.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'TreeNode newTreeNode = Objects.createTreeNode(\n        // highlight-next-line\n        treeNode, // existing data\n        root -> {\n            root\n                .childNodes(false).get(0) // Food\n                .childNodes(false).get(0) // Drink\n                .childNodes(false).get(0) // Cococola\n                .setName("Cococola plus");\n        }\n);\n\n// Show that `newTreeNode` reflects the developer\'s desired modifications\n// Note that this does not affect the existing `treeNode` at all\n\nSystem.out.println("treeNode:" + treeNode);\nSystem.out.println("newTreeNode:" + newTreeNode);\n'))),(0,o.kt)(l.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'/*\n * val newTreeNode = treeNode.copy {\n *     ...\n * }\n *\n * is actually shorthand for \n * \n * val newTreeNode = new(TreeNode::class).by(treeNode) {\n *     ...\n * }\n */\nval newTreeNode = treeNode.copy {\n    childNodes()[0] // Food\n        .childNodes()[0] // Drinks\n        .childNodes()[0] // Cococola\n        .name += " plus"\n}\n\n// Show that `newTreeNode` reflects the developer\'s desired modifications\n// Note that this does not affect the existing `treeNode` at all\n\nprintln("treeNode: $treeNode")\nprintln("newTreeNode: $newTreeNode")\n')))),(0,o.kt)("p",null,"Output (the actual printed output is compact, but is formatted here for readability)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'treeNode: {\n    "name":"Root",\n    "childNodes":[\n        {\n            "name":"Food",\n            "childNodes":[\n                {\n                    "name":"Drink",\n                    "childNodes":[\n                        // highlight-next-line\n                        {"name":"Coco Cola"},\n                        {"name":"Fanta"}\n                    ]\n                }\n            ]\n        }\n    ]\n}\nnewTreeNode: {\n    "name":"Root",\n    "childNodes":[\n        {\n            "name":"Food",\n            "childNodes":[\n                {\n                    "name":"Drink",\n                    "childNodes":[\n                        // highlight-next-line\n                        {"name":"Coco Cola plus"},\n                        {"name":"Fanta"}\n                    ]\n                }\n            ]\n        }\n    ]\n}\n')),(0,o.kt)("p",null,"As you can see, ",(0,o.kt)("inlineCode",{parentName:"p"},"treeNode")," is unaffected, and ",(0,o.kt)("inlineCode",{parentName:"p"},"newTreeNode")," reflects the user's desired modifications."))}s.isMDXComponent=!0},22049:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>p,default:()=>h,frontMatter:()=>d,metadata:()=>u,toc:()=>k});var n=a(83117),o=(a(67294),a(3905)),r=a(93351),l=a(35892),i=a(39511),s=a(65488),m=a(85162);const d={sidebar_position:2,title:"Simple Mapping"},p=void 0,u={unversionedId:"mapping/base/basic",id:"mapping/base/basic",title:"Simple Mapping",description:"@Entity",source:"@site/docs/mapping/base/basic.mdx",sourceDirName:"mapping/base",slug:"/mapping/base/basic",permalink:"/jimmer-doc/docs/mapping/base/basic",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/mapping/base/basic.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Simple Mapping"},sidebar:"tutorialSidebar",previous:{title:"Nullity",permalink:"/jimmer-doc/docs/mapping/base/nullity"},next:{title:"Association Mapping",permalink:"/jimmer-doc/docs/mapping/base/association/"}},c={},k=[{value:"@Entity",id:"entity",level:2},{value:"@Table",id:"table",level:2},{value:"@Column",id:"column",level:2},{value:"@Id",id:"id",level:2},{value:"@GeneratedValue",id:"generatedvalue",level:2},{value:"Database autoincrement",id:"database-autoincrement",level:3},{value:"Database sequence",id:"database-sequence",level:3},{value:"UUID",id:"uuid",level:3},{value:"Custom IdGenerator",id:"custom-idgenerator",level:3}],g={toc:k};function h(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"entity"},"@Entity"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"@Entity")," annotation is used to decorate immutable interfaces to represent ORM entities."),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"// highlight-next-line\n@Entity\npublic interface Book {\n    ...Omit other code...\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"// highlight-next-line \n@Entity\ninterface Book {\n    ...Omit other code...\n}\n")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Why are entity types interfaces instead of classes?"),(0,o.kt)("p",{parentName:"admonition"},"Jimmer entities have ",(0,o.kt)(i.b,{buttonText:"dynamic shapes",mdxType:"ViewMore"},(0,o.kt)(r.ZP,{mdxType:"DynamicShape"}))," and ",(0,o.kt)(i.b,{buttonText:"immutability",mdxType:"ViewMore"},(0,o.kt)(l.ZP,{mdxType:"ImmutableSolution"})),",\nwhich are not simple POJOs with intricate internal workings that cannot be accomplished manually or with lombok assistance."),(0,o.kt)("p",{parentName:"admonition"},"So Jimmer lets developers write interfaces that are implemented at compile time by preprocessors ",(0,o.kt)("em",{parentName:"p"},"(AnnotationProcessor for Java, KSP for Kotlin)"),".  ")),(0,o.kt)("h2",{id:"table"},"@Table"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"@Table")," annotation specifies the table name for the entity. If ",(0,o.kt)("inlineCode",{parentName:"p"},"@Table")," annotation is not used, e.g."),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookStore.java"',title:'"BookStore.java"'},"@Entity\npublic interface BookStore {\n    ...Omit other code... \n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookStore.kt"',title:'"BookStore.kt"'},"@Entity\ninterface BookStore {\n    ...Omit other code...\n} \n")))),(0,o.kt)("p",null,"Jimmer will deduce the table name corresponding to the ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," interface based on the ",(0,o.kt)("a",{parentName:"p",href:"./naming-strategy"},"naming strategy"),". "),(0,o.kt)("p",null,"If the default ",(0,o.kt)("a",{parentName:"p",href:"./naming-strategy"},"naming strategy")," is not overridden by the user, the table name for interface ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_STORE"),". So the previous code is equivalent to:"),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookStore.java"',title:'"BookStore.java"'},'@Entity\n// highlight-next-line  \n@Table("BOOK_STORE")\npublic interface BookStore {\n    ...Omit other code...\n}\n'))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookStore.kt"',title:'"BookStore.kt"'},'@Entity\n// highlight-next-line\n@Table("BOOK_STORE") \ninterface BookStore {\n    ...Omit other code...\n}\n')))),(0,o.kt)("h2",{id:"column"},"@Column"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"@Column")," annotation specifies the database column for ordinary non-associative properties. If ",(0,o.kt)("inlineCode",{parentName:"p"},"@Column")," annotation is not used, e.g."),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Author.java"',title:'"Author.java"'},"@Entity \npublic interface BookStore {\n\n    String firstName();\n\n    ...Omit other code...\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Author.kt"',title:'"Author.kt"'},"@Entity\ninterface Author {\n\n    val firstName: String\n\n    ...Omit other code...\n}\n")))),(0,o.kt)("p",null,"Jimmer will deduce the column name corresponding to the ",(0,o.kt)("inlineCode",{parentName:"p"},"firstName")," property based on the ",(0,o.kt)("a",{parentName:"p",href:"./naming-strategy"},"naming strategy"),"."),(0,o.kt)("p",null,"If the default ",(0,o.kt)("a",{parentName:"p",href:"./naming-strategy"},"naming strategy")," is not overridden by the user, the column name for property ",(0,o.kt)("inlineCode",{parentName:"p"},"firstName")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"FIRST_NAME"),". So the previous code is equivalent to:  "),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Author.java"',title:'"Author.java"'},'@Entity\npublic interface BookStore {\n\n    // highlight-next-line\n    @Column(name = "FIRST_NAME") \n    String firstName();\n\n    ...Omit other code...\n}\n'))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Author.kt"',title:'"Author.kt"'},'@Entity \ninterface Author {\n\n    // highlight-next-line\n    @Column(name = "FIRST_NAME")\n    val firstName: String\n\n    ...Omit other code...\n}\n')))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"@Column")," is only used to explicitly specify column names for non-associative properties. For foreign key column names of many-to-one or one-to-one association properties, they must be specified through ",(0,o.kt)("inlineCode",{parentName:"p"},"@JoinColumn"),". See ",(0,o.kt)("a",{parentName:"p",href:"./association"},"Association Mapping")," for more.")),(0,o.kt)("h2",{id:"id"},"@Id"),(0,o.kt)("p",null,"Declare a property as the id property, as follows"),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    // highlight-next-line\n    @Id  \n    long id();\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    // highlight-next-line\n    @Id\n    val id: Long\n}\n")))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The id field must be non-null ",(0,o.kt)("em",{parentName:"p"},"(for Java, ",(0,o.kt)("inlineCode",{parentName:"em"},"long")," is used here instead of ",(0,o.kt)("inlineCode",{parentName:"em"},"Long"),")")," "),(0,o.kt)("p",{parentName:"admonition"},"Unlike JPA, which encourages declaring the id as a nullable type, Jimmer does not use this method to express not specifying the id during data insertion. The dynamism of Jimmer objects themselves can easily express this problem."),(0,o.kt)("p",{parentName:"admonition"},"See ",(0,o.kt)("a",{parentName:"p",href:"./nullity"},"Nullity")," for details.  ")),(0,o.kt)("h2",{id:"generatedvalue"},"@GeneratedValue"),(0,o.kt)("p",null,"In the previous example, the primary key property decorated with ",(0,o.kt)("inlineCode",{parentName:"p"},"@Id")," is a business field that must be specified when inserting data."),(0,o.kt)("p",null,"However, more often, we expect that the primary key property itself has no business meaning, so that it can be unspecified when inserting data and automatically generated instead. The automatic id generation strategies are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Database autoincrement"),(0,o.kt)("li",{parentName:"ul"},"Database sequence"),(0,o.kt)("li",{parentName:"ul"},"UUID"),(0,o.kt)("li",{parentName:"ul"},"Snowflake ID")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"@GeneratedValue")," works with ",(0,o.kt)("inlineCode",{parentName:"p"},"@Id")," to specify auto growth strategy for Id."),(0,o.kt)("h3",{id:"database-autoincrement"},"Database autoincrement"),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    @Id  \n    @GeneratedValue(strategy = GenerationType.IDENTITY)\n    long id();\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.IDENTITY) \n    val id: Long\n}\n")))),(0,o.kt)("h3",{id:"database-sequence"},"Database sequence"),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.SEQUENCE)  \n    long id();\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity \ninterface Book {\n\n    @Id\n    @GeneratedValue(strategy = GenerationType.SEQUENCE)\n    val id: Long \n}\n")))),(0,o.kt)("p",null,"Here, the sequence name in the database is not specified through the ",(0,o.kt)("inlineCode",{parentName:"p"},"sequenceName")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"@GeneratorValue"),". Jimmer will deduce the sequence name based on the ",(0,o.kt)("a",{parentName:"p",href:"./naming-strategy"},"naming strategy"),".  "),(0,o.kt)("p",null,"If the default ",(0,o.kt)("a",{parentName:"p",href:"./naming-strategy"},"naming strategy")," is not overridden by the user, the sequence name here is ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_ID_SEQ"),". So the previous code is equivalent to:"),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},'@Entity\npublic interface Book {\n\n    @Id\n    @GeneratedValue(\n        strategy = GenerationType.SEQUENCE,\n        // highlight-next-line\n        sequenceName = "BOOK_ID_SEQ" \n    )\n    long id();\n}\n'))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},'@Entity  \ninterface Book {\n\n    @Id\n    @GeneratedValue(\n        strategy = GenerationType.SEQUENCE,\n        // highlight-next-line\n        sequenceName = "BOOK_ID_SEQ"\n    )\n    val id: Long\n}\n')))),(0,o.kt)("h3",{id:"uuid"},"UUID"),(0,o.kt)("p",null,"Setting the generatorType property of ",(0,o.kt)("inlineCode",{parentName:"p"},"@GeneratedValue")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"org.babyfish.jimmer.sql.meta.UUIDIdGenerator")," can be used to randomly generate UUIDs"),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    @Id\n    @GeneratedValue(generatorType = UUIDIdGenerator.class) \n    UUID id();\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    @Id\n    @GeneratedValue(generatorType = UUIDIdGenerator::class)\n    val id: UUID\n} \n")))),(0,o.kt)("h3",{id:"custom-idgenerator"},"Custom IdGenerator"),(0,o.kt)("p",null,"When the above Id growth strategies cannot meet the requirements, a custom Id generation strategy can be defined."),(0,o.kt)("p",null,"Jimmer provides an ",(0,o.kt)("inlineCode",{parentName:"p"},"UserIdGenerator<T>")," interface"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="UserIdGenerator.java"',title:'"UserIdGenerator.java"'},"package org.babyfish.jimmer.sql.meta;\n\npublic interface UserIdGenerator<T> extends IdGenerator {\n\n    T generate(Class<?> entityType); \n}\n")),(0,o.kt)("p",null,"Users can implement this interface to implement any Id generation algorithm, including snowflake ID."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="MyGenerator.java"',title:'"MyGenerator.java"'},"package com.mycompany.myproject.common;\n\npublic class MyIdGenerator implements UserIdGenerator<Long> {\n\n    @Override\n    public Long generate(Class<?> entityType) {\n        return ...Omit custom id generation logic...\n    }\n}\n")),(0,o.kt)(s.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(m.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},"@Entity\npublic interface Book {\n\n    @Id\n    @GeneratedValue(generateType = MyIdGenerator.class)\n    Long id();\n}\n"))),(0,o.kt)(m.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},"@Entity\ninterface Book {\n\n    @Id \n    @GeneratedValue(generateType = MyIdGenerator::class)\n    val id: Long  \n}\n")))),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The user-implemented Id generation class ",(0,o.kt)("inlineCode",{parentName:"p"},"MyIdGenerator")," itself does not have generic parameters, but generic parameters must be specified for the super interface ",(0,o.kt)("inlineCode",{parentName:"p"},"UserIdGenerator"),"."),(0,o.kt)("p",{parentName:"admonition"},"The type of the decorated Id property must be consistent with this generic parameter, otherwise an exception will be thrown.")))}h.isMDXComponent=!0}}]);