"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[1176],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>h});var n=a(67294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(a),h=o,u=d["".concat(l,".").concat(h)]||d[h]||m[h]||i;return a?n.createElement(u,r(r({ref:t},p),{},{components:a})):n.createElement(u,r({ref:t},p))}));function h(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=a.length,r=new Array(i);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=a[c];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},15368:(e,t,a)=>{a.d(t,{Z:()=>v});var n,o,i,r,s,l,c,p,m,d,h,u,A,b,k,f,g,y=a(67294);function N(){return N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},N.apply(this,arguments)}const v=e=>{let{title:t,titleId:a,...v}=e;return y.createElement("svg",N({width:431,height:202,xmlns:"http://www.w3.org/2000/svg","aria-labelledby":a},v),t?y.createElement("title",{id:a},t):null,n||(n=y.createElement("path",{d:"M25 29q0-4 4-4h77q4 0 4 4v25q0 4-4 4H29q-4 0-4-4Z",stroke:"rgba(33,41,48,1)",strokeWidth:2,fill:"#fff"})),o||(o=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:5.875,transform:"translate(25 25)"},y.createElement("tspan",{dy:16,x:42.5},y.createElement("tspan",null,"BookStore")))),i||(i=y.createElement("path",{d:"M173 29q0-4 4-4h77q4 0 4 4v25q0 4-4 4h-77q-4 0-4-4Z",stroke:"rgba(33,41,48,1)",strokeWidth:2,fill:"#fff"})),r||(r=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:5.875,transform:"translate(173 25)"},y.createElement("tspan",{dy:16,x:42.5},y.createElement("tspan",null,"Book")))),s||(s=y.createElement("path",{d:"M321 29q0-4 4-4h77q4 0 4 4v25q0 4-4 4h-77q-4 0-4-4Z",stroke:"rgba(33,41,48,1)",strokeWidth:2,fill:"#fff"})),l||(l=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:5.875,transform:"translate(321 25)"},y.createElement("tspan",{dy:16,x:42.5},y.createElement("tspan",null,"Author")))),c||(c=y.createElement("path",{d:"M25 148q0-4 4-4h79q4 0 4 4v25q0 4-4 4H29q-4 0-4-4Z",stroke:"rgba(33,41,48,1)",strokeWidth:2,fill:"#fff"})),p||(p=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:5.875,transform:"translate(25 144)"},y.createElement("tspan",{dy:16,x:43.5},y.createElement("tspan",null,"TreeNode")))),m||(m=y.createElement("path",{d:"M111 42h61",stroke:"#7f7f7f",strokeWidth:2,fill:"none"})),d||(d=y.createElement("path",{fill:"#fff",d:"M131 34h21v16h-21z"})),h||(h=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:31.375},y.createElement("tspan",{dy:16,x:141.5},y.createElement("tspan",null,"0:N")))),u||(u=y.createElement("path",{d:"M259 42h61",stroke:"#7f8b98",strokeWidth:2,fill:"none"})),A||(A=y.createElement("path",{fill:"#fff",d:"M277.5 34h24v16h-24z"})),b||(b=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:31.375},y.createElement("tspan",{dy:16,x:289.5},y.createElement("tspan",null,"M:N")))),k||(k=y.createElement("path",{d:"m68.983 143-.483-29H142v47h-29",stroke:"#7f8b98",strokeWidth:2,fill:"none"})),f||(f=y.createElement("path",{fill:"#fff",d:"M118.248 106h21v16h-21z"})),g||(g=y.createElement("text",{fontFamily:"\\u5FAE\\u8F6F\\u96C5\\u9ED1",textAnchor:"middle",fontSize:13,fill:"#323232",fontWeight:400,y:103.375},y.createElement("tspan",{dy:16,x:128.748},y.createElement("tspan",null,"0:N")))))}},85162:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(67294),o=a(34334);const i="tabItem_Ymn6";function r(e){let{children:t,hidden:a,className:r}=e;return n.createElement("div",{role:"tabpanel",className:(0,o.Z)(i,r),hidden:a},t)}},65488:(e,t,a)=>{a.d(t,{Z:()=>h});var n=a(83117),o=a(67294),i=a(34334),r=a(72389),s=a(67392),l=a(7094),c=a(12466);const p="tabList__CuJ",m="tabItem_LNqP";function d(e){var t;const{lazy:a,block:r,defaultValue:d,values:h,groupId:u,className:A}=e,b=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),k=h??b.map((e=>{let{props:{value:t,label:a,attributes:n}}=e;return{value:t,label:a,attributes:n}})),f=(0,s.l)(k,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const g=null===d?d:d??(null==(t=b.find((e=>e.props.default)))?void 0:t.props.value)??b[0].props.value;if(null!==g&&!k.some((e=>e.value===g)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${g}" but none of its children has the corresponding value. Available values are: ${k.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:y,setTabGroupChoices:N}=(0,l.U)(),[v,B]=(0,o.useState)(g),E=[],{blockElementScrollPositionUntilNextRender:C}=(0,c.o5)();if(null!=u){const e=y[u];null!=e&&e!==v&&k.some((t=>t.value===e))&&B(e)}const j=e=>{const t=e.currentTarget,a=E.indexOf(t),n=k[a].value;n!==v&&(C(t),B(n),null!=u&&N(u,String(n)))},T=e=>{var t;let a=null;switch(e.key){case"ArrowRight":{const t=E.indexOf(e.currentTarget)+1;a=E[t]??E[0];break}case"ArrowLeft":{const t=E.indexOf(e.currentTarget)-1;a=E[t]??E[E.length-1];break}}null==(t=a)||t.focus()};return o.createElement("div",{className:(0,i.Z)("tabs-container",p)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":r},A)},k.map((e=>{let{value:t,label:a,attributes:r}=e;return o.createElement("li",(0,n.Z)({role:"tab",tabIndex:v===t?0:-1,"aria-selected":v===t,key:t,ref:e=>E.push(e),onKeyDown:T,onFocus:j,onClick:j},r,{className:(0,i.Z)("tabs__item",m,null==r?void 0:r.className,{"tabs__item--active":v===t})}),a??t)}))),a?(0,o.cloneElement)(b.filter((e=>e.props.value===v))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},b.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==v})))))}function h(e){const t=(0,r.Z)();return o.createElement(d,(0,n.Z)({key:String(t)},e))}},41220:(e,t,a)=>{a.d(t,{$0:()=>g,BP:()=>d,Hj:()=>u,Kj:()=>A,RI:()=>m,ZJ:()=>b,_R:()=>w,aO:()=>y,bD:()=>j,bg:()=>C,bn:()=>B,ce:()=>N,ef:()=>E,gc:()=>k,i5:()=>f,jl:()=>T,qj:()=>h,vc:()=>v,zf:()=>p});var n=a(67294),o=a(98456),i=a(21737),r=a(53143),s=a(86886),l=a(72389);const c=(0,n.memo)((e=>{let{src:t}=e;const a=(0,r.S)(),[c,p]=(0,n.useState)(!1),m=(0,n.useCallback)((()=>p(!0)),[]),d=(0,l.Z)();return d&&!function(){const e=O;if("boolean"==typeof e)return e;var t=document.createElement("canvas");const a=t.getContext&&t.getContext("2d")&&0==t.toDataURL("image/webp").indexOf("data:image/webp");return O=a,a}()&&t.endsWith(".webp")?n.createElement(i.Z,{security:"error"},a?"\u65e0\u6cd5\u5c55\u793a\u56fe\u7247\uff0c\u8bf7\u4f7f\u7528\u652f\u6301webp\u7684\u6d4f\u89c8\u5668":"Unable to display image, please use a browser that supports webp"):n.createElement(n.Fragment,null,d&&!c&&n.createElement(s.ZP,{container:!0,direction:"column",alignItems:"center"},n.createElement(s.ZP,{item:!0},n.createElement(o.Z,null)),n.createElement(s.ZP,{item:!0},a?"\u52a0\u8f7d\u56fe\u7247\u4e2d":"Loading image")),n.createElement("img",{src:t,onLoad:m}))})),p=(0,n.memo)((()=>n.createElement(c,{src:S}))),m=(0,n.memo)((()=>n.createElement(c,{src:I}))),d=(0,n.memo)((()=>n.createElement(c,{src:x}))),h=(0,n.memo)((()=>n.createElement(c,{src:Z}))),u=(0,n.memo)((()=>n.createElement(c,{src:F}))),A=(0,n.memo)((()=>n.createElement(c,{src:D}))),b=(0,n.memo)((()=>n.createElement(c,{src:q}))),k=(0,n.memo)((()=>n.createElement(c,{src:M}))),f=(0,n.memo)((()=>n.createElement(c,{src:L}))),g=(0,n.memo)((()=>n.createElement(c,{src:R}))),y=(0,n.memo)((()=>n.createElement(c,{src:P}))),N=(0,n.memo)((()=>n.createElement(c,{src:H}))),v=(0,n.memo)((()=>n.createElement(c,{src:K}))),B=(0,n.memo)((()=>n.createElement(c,{src:Q}))),E=(0,n.memo)((()=>n.createElement(c,{src:G}))),C=(0,n.memo)((()=>n.createElement(c,{src:J}))),j=(0,n.memo)((()=>n.createElement(c,{src:U}))),T=(0,n.memo)((()=>n.createElement(c,{src:V}))),w=(0,n.memo)((()=>n.createElement(c,{src:W})));let O;const S=a(74513).Z,I=a(61278).Z,x=a(64608).Z,Z=a(29148).Z,F=a(71876).Z,D=a(86116).Z,q=a(68393).Z,M=a(78706).Z,L=a(55666).Z,R=a(12036).Z,P=a(65048).Z,H=a(34502).Z,K=a(91059).Z,Q=a(66003).Z,G=(a(15368).Z,a(55515).Z),J=a(20466).Z,U=a(98272).Z,V=a(27557).Z,W=a(69339).Z;a(21283).Z},32102:(e,t,a)=>{a.d(t,{s:()=>A});var n=a(83117),o=a(67294),i=a(42293),r=a(50657),s=a(6514),l=a(54776),c=a(10155),p=a(15861),m=a(93946),d=a(9137),h=a(61274),u=a(50594);const A=(0,o.memo)((e=>{let{open:t,fullScreen:a=!1,title:n,onClose:l,children:A}=e;const[k,f]=(0,o.useState)(a),g=(0,o.useCallback)((()=>{f((e=>!e))}),[]);return o.createElement(r.Z,{open:t,onClose:l,fullScreen:k,TransitionComponent:b,maxWidth:"md"},o.createElement(i.Z,{sx:{position:"relative"}},o.createElement(c.Z,null,o.createElement(p.Z,{sx:{ml:2,flex:1},variant:"h6",component:"div"},n),o.createElement(m.Z,{onClick:g,style:{color:"white"}},k?o.createElement(h.Z,null):o.createElement(d.Z,null)),o.createElement(m.Z,{"aria-label":"close",onClick:l,style:{color:"white"}},o.createElement(u.Z,null)))),o.createElement(s.Z,null,A))})),b=o.forwardRef((function(e,t){return o.createElement(l.Z,(0,n.Z)({direction:"up",ref:t},e))}))},39511:(e,t,a)=>{a.d(t,{b:()=>r});var n=a(67294),o=a(83321),i=a(32102);const r=(0,n.memo)((e=>{let{buttonText:t,fullScreen:a=!1,title:r=t,children:s}=e;const[l,c]=(0,n.useState)(!1),p=(0,n.useCallback)((e=>{c(!0),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),[]),m=(0,n.useCallback)((()=>{c(!1)}),[]);return n.createElement(n.Fragment,null,n.createElement(o.Z,{"data-is-view-more-button":"true",onClick:p,variant:"outlined",size:"small"},t),n.createElement(i.s,{open:l,onClose:m,title:r,fullScreen:a},s))}))},53143:(e,t,a)=>{a.d(t,{S:()=>o});var n=a(52263);function o(){const{i18n:e}=(0,n.Z)(),t=e.currentLocale;return"zh"===t||"zh_cn"===t||"zh_CN"==t}},36882:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>p,default:()=>A,frontMatter:()=>c,metadata:()=>m,toc:()=>h});var n=a(83117),o=(a(67294),a(3905)),i=a(65488),r=a(85162),s=a(39511),l=a(41220);const c={sidebar_position:2,title:"Association Cache"},p=void 0,m={unversionedId:"cache/cache-type/association",id:"cache/cache-type/association",title:"Association Cache",description:"Association cache refers to mapping the current object id to the associated object id or collection.",source:"@site/docs/cache/cache-type/association.mdx",sourceDirName:"cache/cache-type",slug:"/cache/cache-type/association",permalink:"/jimmer-doc/docs/cache/cache-type/association",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/cache/cache-type/association.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Association Cache"},sidebar:"tutorialSidebar",previous:{title:"Object Cache",permalink:"/jimmer-doc/docs/cache/cache-type/object"},next:{title:"Calculated Cache",permalink:"/jimmer-doc/docs/cache/cache-type/calculation"}},d={},h=[{value:"Enabling Association Cache",id:"enabling-association-cache",level:2},{value:"Sorting Collection Associations",id:"sorting-collection-associations",level:2},{value:"Usage",id:"usage",level:2},{value:"One-to-Many: BookStore.books",id:"one-to-many-bookstorebooks",level:3},{value:"Many-to-Many: Book.authors",id:"many-to-many-bookauthors",level:3},{value:"Cache Invalidation",id:"cache-invalidation",level:2},{value:"One-to-Many: BookStore.books",id:"one-to-many-bookstorebooks-1",level:3},{value:"Many-to-Many: Book.authors",id:"many-to-many-bookauthors-1",level:3},{value:"Notes on Logical Deletion",id:"notes-on-logical-deletion",level:2}],u={toc:h};function A(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Association cache refers to mapping the current object id to the associated object id or collection."),(0,o.kt)(l.BP,{mdxType:"AssociationCache"}),(0,o.kt)("p",null,"Where:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"BookStore.books-*"),": One-to-many association cache  "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Book.store-*"),": Many-to-one association cache"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Book.authors-*"),": Many-to-many association cache"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"Author.books-*"),": Many-to-many association cache  ")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Unlike other association caches, there is one scenario that does not require using one-to-one or many-to-one association cache."),(0,o.kt)("p",{parentName:"admonition"},"If a one-to-one or many-to-one association is based on a real foreign key with a corresponding foreign key constraint in the database, then the foreign key itself is the associated object id, and association cache is not required."),(0,o.kt)("p",{parentName:"admonition"},"In other cases, Jimmer will use one-to-one or many-to-one association cache. These cases include:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The referenced association property is reverse side"),(0,o.kt)("p",{parentName:"li"},"That is, ",(0,o.kt)("inlineCode",{parentName:"p"},"@OneToOne"),"'s ",(0,o.kt)("inlineCode",{parentName:"p"},"mappedBy")," is configured.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The referenced association property is based on a pseudo foreign key"),(0,o.kt)("p",{parentName:"li"},"A pseudo foreign key means that it is conceptually a foreign key in the developer's mind, but there is no corresponding foreign key constraint in the database."),(0,o.kt)("p",{parentName:"li"},"The pseudo foreign key field may contain illegal values, the non-null value does not mean the associated object exists, so association cache is required to filter out valid associated objects.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The referenced association property is based on a join table rather than a foreign key. ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"When ",(0,o.kt)("a",{parentName:"p",href:"../../graphql"},"implementing GraphQL with Jimmer"),", ",(0,o.kt)("a",{parentName:"p",href:"../../query/object-fetcher"},"Object Fetcher")," ",(0,o.kt)("em",{parentName:"p"},"(GraphQL and Object Fetchers are homogenous functions)")," should not be used in aggregate root queries,\nbut object fetcher were incorrectly used in aggregate root queries to obtain objects without foreign keys. However, the GraphQL request body contains many-to-one associations.")))),(0,o.kt)("p",null,"In the official sample code included, the many-to-one association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store")," is based on a real foreign key, so its many-to-one cache will not be used."),(0,o.kt)("p",null,"Therefore, the examples in this article use the one-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")," and the many-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors"),"."),(0,o.kt)("h2",{id:"enabling-association-cache"},"Enabling Association Cache"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"@Bean\npublic CacheFactory cacheFactory(\n    RedisConnectionFactory connectionFactory,\n    ObjectMapper objectMapper\n) {\n\n    RedisTemplate<String, byte[]> redisTemplate = \n        RedisCaches.cacheRedisTemplate(connectionFactory);\n\n    return new CacheFactory() {\n\n        @Override\n        public Cache<?, ?> createObjectCache(@NotNull ImmutableType type) {\n            ...omit code...\n        }\n\n        // Map current object id to associated object id\n        // Applies to one-to-one and many-to-one associations \n        @Override\n        // highlight-next-line\n        public Cache<?, ?> createAssociatedIdCache(@NotNull ImmutableProp prop) {\n            return createPropCache(prop, Duration.ofMinutes(10));\n        }\n\n        // Map current object id to collection of associated object ids\n        // Applies to one-to-many and many-to-many associations\n        @Override\n        // highlight-next-line\n        public Cache<?, List<?>> createAssociatedIdListCache(@NotNull ImmutableProp prop) {\n            return createPropCache(prop, Duration.ofMinutes(5));\n        }\n\n        private <K, V> Cache<K, V> createPropCache(ImmutableProp prop, Duration duration) {\n            return new ChainCacheBuilder<>()\n                .add(\n                    new CaffeineBinder<>(512, Duration.ofSeconds(1))\n                )\n                .add(\n                    new RedisValueBinder<>(\n                        redisTemplate, \n                        objectMapper, \n                        prop, \n                        duration\n                    )\n                )\n                .build();\n        }\n\n        ...omit other code...\n    };\n}\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"@Bean\nfun cacheFactory(\n    connectionFactory: RedisConnectionFactory,\n    objectMapper: ObjectMapper  \n): KCacheFactory {\n\n    val redisTemplate = RedisCaches.cacheRedisTemplate(connectionFactory)\n\n    return object: KCacheFactory {\n\n        override fun createObjectCache(type: ImmutableType): Cache<*, *>? =\n            ...omit code...\n\n        // Map current object id to associated object id\n        // Applies to one-to-one and many-to-one associations\n        // highlight-next-line\n        override fun createAssociatedIdCache(prop: ImmutableProp): Cache<*, *>? =\n            createPropCache(prop, Duration.ofMinutes(10))\n\n        // Map current object id to collection of associated object ids\n        // Applies to one-to-many and many-to-many associations \n        // highlight-next-line\n        override fun createAssociatedIdListCache(prop: ImmutableProp): Cache<*, List<*>>? =\n            createPropCache(prop, Duration.ofMinutes(5))\n\n        private fun <K, V> createPropCache(prop: ImmutableProp, duration: Duration): Cache<K, V> =\n            ChainCacheBuilder<Any, Any>()\n                .add(\n                    CaffeineBinder(512, Duration.ofSeconds(1))\n                )\n                .add(\n                    RedisValueBinder(\n                        redisTemplate, \n                        objectMapper, \n                        prop,  \n                        duration\n                    )\n                )\n                .build()\n\n        ...omit other code...\n    }\n}\n")))),(0,o.kt)("h2",{id:"sorting-collection-associations"},"Sorting Collection Associations"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"For collection type associations, if we use the field filter of ",(0,o.kt)("a",{parentName:"p",href:"../../query/object-fetcher"},"object fetchers")," to implement association-level sorting, it will cause Jimmer to ignore association cache."),(0,o.kt)("p",{parentName:"admonition"},"To make full use of association cache while keeping the sorting of the associated object collection returned by the ",(0,o.kt)("a",{parentName:"p",href:"../../query/object-fetcher"},"object fetcher")," query controllable, you can specify the default sorting statically on the entity.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookStore.java"',title:'"BookStore.java"'},'@Entity\npublic interface BookStore {\n\n    @OneToMany(\n        mappedBy = "store",\n        // highlight-next-line\n        orderedProps = {\n                @OrderedProp("name"),\n                @OrderedProp(value = "edition", desc = true)\n        }\n    )\n    List<Book> books();\n\n    ...omit other code...\n}\n'))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookStore.kt"',title:'"BookStore.kt"'},'@Entity  \ninterface BookStore {\n\n    @OneToMany(\n        mappedBy = "store",\n        // highlight-next-line\n        orderedProps = {\n                @OrderedProp("name"),\n                @OrderedProp(value = "edition", desc = true)\n        }\n    )\n    val books : List<Book>\n\n    ...omit other code...\n}\n'))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="Book.java"',title:'"Book.java"'},'@Entity\npublic interface Book {\n\n    @ManyToMany(\n        // highlight-next-line\n        orderedProps = {\n            @OrderedProp("firstName"),\n            @OrderedProp("lastName")\n        }  \n    )\n    List<Author> authors();\n\n    ...omit other code...\n}\n'))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="Book.kt"',title:'"Book.kt"'},'@Entity\ninterface Book {\n\n    @ManyToMany(\n        // highlight-next-line\n        orderedProps = {\n            @OrderedProp("firstName"),\n            @OrderedProp("lastName")\n        }\n    )\n    val authors : List<Author>\n\n    ...omit other code...\n}\n')))))),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,"As mentioned at the beginning of this article, the examples here are based on the one-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")," and the many-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors"),"."),(0,o.kt)("h3",{id:"one-to-many-bookstorebooks"},"One-to-Many: BookStore.books"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"BookStoreTable table = Tables.BOOK_STORE_TABLE;\nList<BookStore> stores = sqlClient\n    .createQuery(table)\n    .select(\n        table.fetch(\n            Fetchers.BOOK_STORE_FETCHER\n                .allScalarFields()\n                // highlight-next-line\n                .books(\n                    Fetchers.BOOK_FETCHER\n                        .allScalarFields()\n                )\n        )\n    )\n    .execute();\nSystem.out.println(stores);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"val stores = sqlClient\n    .createQuery(BookStore::class) {\n        select(\n            table.fetchBy {\n                allScalarFields()\n                // highlight-next-line\n                books {\n                    allScalarFields()\n                }\n            }\n        )\n    }\n    .execute()\nprintln(stores)\n")))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Step 1: Query aggregate root"),(0,o.kt)("p",{parentName:"li"},"First, query the aggregate root object, executing the following SQL:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.WEBSITE\nfrom BOOK_STORE tb_1_\n")),(0,o.kt)("p",{parentName:"li"},"The query in the code is implemented here to obtain some BookStore objects. Such objects obtained by direct user queries are called aggregate root objects."),(0,o.kt)("admonition",{parentName:"li",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Jimmer does not cache aggregate objects returned by user queries, because the consistency of such query results cannot be guaranteed."),(0,o.kt)("p",{parentName:"admonition"},"Even if cache them at the cost of sacrificing consistency is required, it is a business need of the user rather than the framework."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Step 2: Convert current object id to associated object id via association cache"),(0,o.kt)("p",{parentName:"li"},"The above code will return a series of aggregate root objects. If using the official sample data in the database, it will return two aggregate root objects."),(0,o.kt)("p",{parentName:"li"},"The object fetcher in the code contains the one-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")),(0,o.kt)("p",{parentName:"li"},"The primary keys ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," of these 2 BOOK_STOREs are 1 and 2."),(0,o.kt)("p",{parentName:"li"},"Jimmer first looks up the data in Redis with keys ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books-1")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books-2"),"."),(0,o.kt)("p",{parentName:"li"},"Suppose the data corresponding to these keys cannot be found in Redis:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"127.0.0.1:6379> keys BookStore.books-*\n(empty array)\n")),(0,o.kt)("p",{parentName:"li"},"So the following SQL is executed to load data from the database:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.STORE_ID,\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE\nfrom BOOK tb_1_\nwhere\n    tb_1_.STORE_ID in (\n        ? /* 1 */, ? /* 2 */\n    )\norder by\n    tb_1_.NAME asc,\n    tb_1_.EDITION desc\n")),(0,o.kt)("p",{parentName:"li"},"Jimmer will put the results of the query into Redis, so we can view this data in Redis:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'127.0.0.1:6379> keys BookStore.books-*\n1) "BookStore.books-2"\n2) "BookStore.books-1"\n127.0.0.1:6379> get BookStore.books-1\n"[6,5,4,3,2,1,9,8,7]"\n127.0.0.1:6379> get BookStore.books-2\n"[12,11,10]" \n127.0.0.1:6379>\n')),(0,o.kt)("p",{parentName:"li"},"Thus, the two ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," objects can obtain the associated object id collections of their respective one-to-many associations ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books"),"."),(0,o.kt)("p",{parentName:"li"},"Undoubtedly, before the data in Redis expires, executing the Java/Kotlin code above again will directly return the associated data from Redis without generating the second SQL statement.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Step 3: Convert associated object id to associated object via object cache"),(0,o.kt)("p",{parentName:"li"},"Such operations have been discussed in detail in ",(0,o.kt)("a",{parentName:"p",href:"./object"},"Object Cache"),", so they are not repeated here. This article focuses on association cache."),(0,o.kt)("admonition",{parentName:"li",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"In the cache configuration, if association cache is enabled for an association property but object cache is not enabled for its associated object type, an exception will be thrown.")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Previously in ",(0,o.kt)("a",{parentName:"p",href:"../../query/object-fetcher"},"Object Fetcher"),", we saw that Jimmer only needs one SQL statement to query all associated objects based on a batch of current objects, but here two SQL statements are needed, please view:"),(0,o.kt)(s.b,{buttonText:"The difference compared to not enabling cache",mdxType:"ViewMore"},(0,o.kt)("h1",{parentName:"admonition",id:"cache-mode"},"Cache Mode"),(0,o.kt)("p",{parentName:"admonition"},"In cache mode, this example has three execution steps:"),(0,o.kt)("ol",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Query aggregate root from database"),(0,o.kt)("p",{parentName:"li"},"Regardless of whether cache is enabled, this step is the same, no need to discuss.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Based on the ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books")," association cache, map the aggregate root object id to the associated object id"),(0,o.kt)("p",{parentName:"li"},"If no related data exists in the cache, the following SQL will be executed:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    ...omit...\nfrom BOOK tb_1_ \nwhere\n    tb_1_.STORE_ID in (\n        ? /* 1 */, ? /* 2 */\n    )\norder by\n    tb_1_.NAME asc,\n    tb_1_.EDITION desc\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Based on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," object cache, map the associated object id to the associated object"),(0,o.kt)("p",{parentName:"li"},"If no related data exists in the cache, the following SQL will be executed:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    ...omit...\nfrom BOOK tb_1_\nwhere\n    tb_1_.ID in (\n        ?, ?, ?, ?, ?, ?, ?, ?, ?,\n        ?, ?, ?    \n    )\n")))),(0,o.kt)("h1",{parentName:"admonition",id:"no-cache-mode"},"No Cache Mode"),(0,o.kt)("p",{parentName:"admonition"},"If association cache is not enabled, this query only needs two steps. The first step is exactly the same. The second step executes the following SQL query:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    ...omit...\nfrom BOOK tb_1_ \nwhere\n    tb_1_.STORE_ID in (\n        ? /* 1 */, ? /* 2 */\n    )\norder by\n    tb_1_.NAME asc,\n    tb_1_.EDITION desc\n")),(0,o.kt)("h1",{parentName:"admonition",id:"difference-and-summary"},"Difference and Summary"),(0,o.kt)("p",{parentName:"admonition"},"No cache mode: Generate as few SQL statements as possible, make each SQL statement perform as many tasks as possible, such SQL has the best performance."),(0,o.kt)("p",{parentName:"admonition"},"Cache mode: Does not aim to minimize the number of generated SQL statements. From the SQL point of view, the performance is not optimal, but combined with the cache system, the overall performance is optimal.")),"  "),(0,o.kt)("p",null,"Finally, Jimmer concatenates the results of the two steps as the final data returned to the user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n    {\n        "id":1,\n        "name":"O\'REILLY",\n        "website":null,\n        // highlight-next-line\n        "books":[\n            {\n                "id":6,\n                "name":"Effective TypeScript",\n                "edition":3,\n                "price":88\n            },\n            {\n                "id":5,\n                ...omit...\n            },\n            {\n                "id":4,\n                ...omit...\n            },\n            {\n                "id":3,\n                ...omit...\n            },\n            {\n                "id":2,\n                ...omit...\n            },\n            {\n                "id":1,\n                ...omit...\n            },\n            {\n                "id":9,\n                ...omit...\n            },\n            {\n                "id":8,\n                ...omit...\n            },\n            {\n                "id":7,\n                ...omit...\n            }\n        ]\n    },\n    {\n        "id":2,\n        "name":"MANNING",\n        "website":null,\n        // highlight-next-line\n        "books":[\n            {\n                "id":12,\n                "name":"GraphQL in Action",\n                "edition":3,\n                "price":80\n            },\n            {\n                "id":11,\n                ...omit...\n            },\n            {\n                "id":10,\n                ...omit...\n            }\n        ]\n    }\n]\n')),(0,o.kt)("h3",{id:"many-to-many-bookauthors"},"Many-to-Many: Book.authors"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"BookTable table = Tables.BOOK_TABLE;\nList<Book> books = sqlClient\n    .createQuery(table)\n    .where(table.edition().eq(1))\n    .select(\n        table.fetch(\n            Fetchers.BOOK_FETCHER\n                .allScalarFields()\n                // highlight-next-line\n                .authors(\n                    Fetchers.AUTHOR_FETCHER\n                        .allScalarFields()\n                )\n        )\n    )\n    .execute();\nSystem.out.println(books);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"val books = sqlClient\n    .createQuery(Book::class) {\n        where(table.edition eq 1)\n        select(\n            table.fetchBy {\n                allScalarFields()\n                // highlight-next-line\n                authors {\n                    allScalarFields()\n                }\n            }\n        )\n    }\n    .execute()\nprintln(books) \n")))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Step 1: Query aggregate root"),(0,o.kt)("p",{parentName:"li"},"First, query the aggregate root object, executing the following SQL:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE\nfrom BOOK tb_1_\nwhere\n    tb_1_.EDITION = ? /* 1 */\n")),(0,o.kt)("p",{parentName:"li"},"The query in the code is implemented here to obtain some Book objects. Such objects obtained by direct user queries are called aggregate root objects."),(0,o.kt)("admonition",{parentName:"li",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Jimmer does not cache aggregate objects returned by user queries, because the consistency of such query results cannot be guaranteed."),(0,o.kt)("p",{parentName:"admonition"},"Even if cache them at the cost of sacrificing consistency is required, it is a business need of the user rather than the framework."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Step 2: Convert current object id to associated object ids via association cache"),(0,o.kt)("p",{parentName:"li"},"The above code will return a series of aggregate root objects. If using the official sample data in the database, it will return 4 aggregate root objects."),(0,o.kt)("p",{parentName:"li"},"The object fetcher in the code contains the many-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")),(0,o.kt)("p",{parentName:"li"},"The primary keys ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," of these 4 BOOKs are 1, 4, 7 and 10."),(0,o.kt)("p",{parentName:"li"},"Jimmer first looks up the data in Redis with keys ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors-1"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors-4"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors-7")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors-10"),"."),(0,o.kt)("p",{parentName:"li"},"Suppose the data corresponding to these keys cannot be found in Redis:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"127.0.0.1:6379> keys Book.authors-*\n(empty array)\n")),(0,o.kt)("p",{parentName:"li"},"So the following SQL is executed to load data from the database:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.BOOK_ID,\n    tb_1_.AUTHOR_ID\nfrom BOOK_AUTHOR_MAPPING tb_1_\ninner join AUTHOR tb_3_\n    on tb_1_.AUTHOR_ID = tb_3_.ID\nwhere\n    tb_1_.BOOK_ID in (\n        ? /* 1 */, ? /* 4 */, ? /* 7 */, ? /* 10 */\n    )\norder by\n    tb_3_.FIRST_NAME asc,\n    tb_3_.LAST_NAME asc\n")),(0,o.kt)("admonition",{parentName:"li",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If no default sort is specified for the association property ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")," via ",(0,o.kt)("inlineCode",{parentName:"p"},"@ManyToMany.orderedProps"),", the ",(0,o.kt)("inlineCode",{parentName:"p"},"join")," here will not appear.")),(0,o.kt)("p",{parentName:"li"},"Jimmer will put the results of the query into Redis, so we can view this data in Redis:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'127.0.0.1:6379> keys Book.authors-*\n1) "Book.authors-4"\n2) "Book.authors-1" \n3) "Book.authors-10"\n4) "Book.authors-7"\n127.0.0.1:6379> get Book.authors-1\n"[2,1]"\n127.0.0.1:6379> get Book.authors-4\n"[3]"\n127.0.0.1:6379> get Book.authors-7\n"[4]"\n127.0.0.1:6379> get Book.authors-10\n"[5]"\n127.0.0.1:6379>\n')),(0,o.kt)("p",{parentName:"li"},"Thus, we have obtained the associated object id collections that the 4 ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," objects can get through their respective many-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors"),"."),(0,o.kt)("p",{parentName:"li"},"Undoubtedly, before the data in Redis expires, executing the Java/Kotlin code above again will directly return the associated data from Redis without generating the second SQL statement.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Step 3: Convert associated object id to associated object via object cache"),(0,o.kt)("p",{parentName:"li"},"Such operations have been discussed in detail in ",(0,o.kt)("a",{parentName:"p",href:"./object"},"Object Cache"),", so they are not repeated here. This article focuses on association cache."),(0,o.kt)("admonition",{parentName:"li",type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"In the cache configuration, if association cache is enabled for an association property but object cache is not enabled for its associated object type, an exception will be thrown.")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Previously in ",(0,o.kt)("a",{parentName:"p",href:"../../query/object-fetcher"},"Object Fetcher"),", we saw that Jimmer only needs one SQL statement to query all associated objects based on a batch of current objects, but here two SQL statements are needed, please view:"),(0,o.kt)(s.b,{buttonText:"The difference compared to not enabling cache",mdxType:"ViewMore"},(0,o.kt)("h1",{parentName:"admonition",id:"cache-mode-1"},"Cache Mode"),(0,o.kt)("p",{parentName:"admonition"},"In cache mode, this example has three execution steps:"),(0,o.kt)("ol",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Query aggregate root from database"),(0,o.kt)("p",{parentName:"li"},"Regardless of whether cache is enabled, this step is the same, no need to discuss.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Based on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")," association cache, map the aggregate root object id to the associated object ids"),(0,o.kt)("p",{parentName:"li"},"If no related data exists in the cache, the following SQL will be executed:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.BOOK_ID,\n    tb_1_.AUTHOR_ID \nfrom BOOK_AUTHOR_MAPPING tb_1_\ninner join AUTHOR tb_3_\n    on tb_1_.AUTHOR_ID = tb_3_.ID\nwhere\n    tb_1_.BOOK_ID in (\n        ? /* 1 */, ? /* 4 */, ? /* 7 */, ? /* 10 */\n    )\norder by\n    tb_3_.FIRST_NAME asc,\n    tb_3_.LAST_NAME asc\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Based on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," object cache, map the associated object ids to associated objects"),(0,o.kt)("p",{parentName:"li"},"If no related data exists in the cache, the following SQL will be executed:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.ID,\n    tb_1_.FIRST_NAME,\n    tb_1_.LAST_NAME,\n    tb_1_.GENDER\nfrom AUTHOR tb_1_\nwhere\n    tb_1_.ID in (\n        ? /* 2 */, ? /* 1 */, ? /* 4 */, ? /* 3 */, ? /* 5 */ \n    )\n")))),(0,o.kt)("h1",{parentName:"admonition",id:"no-cache-mode-1"},"No Cache Mode"),(0,o.kt)("p",{parentName:"admonition"},"If cache is not enabled, this query only needs two steps. The first step is exactly the same. The second step executes the following SQL query:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_2_.BOOK_ID,\n    tb_1_.ID,\n    tb_1_.FIRST_NAME,\n    tb_1_.LAST_NAME,\n    tb_1_.GENDER\nfrom AUTHOR tb_1_\ninner join BOOK_AUTHOR_MAPPING tb_2_\n    on tb_1_.ID = tb_2_.AUTHOR_ID\nwhere\n    tb_2_.BOOK_ID in (\n        ? /* 1 */, ? /* 4 */, ? /* 7 */, ? /* 10 */\n    )\norder by\n    tb_1_.FIRST_NAME asc, \n    tb_1_.LAST_NAME asc\n")),(0,o.kt)("h1",{parentName:"admonition",id:"difference-and-summary-1"},"Difference and Summary"),(0,o.kt)("p",{parentName:"admonition"},"No cache mode: Generate as few SQL statements as possible, make each SQL statement perform as many tasks as possible, such SQL has the best performance."),(0,o.kt)("p",{parentName:"admonition"},"Cache mode: Does not aim to minimize the number of generated SQL statements. From the SQL point of view, the performance is not optimal, but combined with the cache system, the overall performance is optimal."))),(0,o.kt)("p",null,"Finally, Jimmer concatenates the 3 steps results as the final data returned to the user:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": 1,\n    "name": "Learning GraphQL", \n    "edition": 1,\n    "price": 51,\n    // highlight-next-line  \n    "authors": [\n      {\n        "id": 2,\n        "firstName": "Alex",\n        "lastName": "Banks", \n        "gender": "MALE"\n      },\n      {  \n        "id": 1,\n        "firstName": "Eve",\n        "lastName": "Procello",\n        "gender": "FEMALE"  \n      }\n    ]\n  },\n  {\n    "id": 4,\n    "name": "Effective TypeScript",\n    "edition": 1, \n    "price": 73,\n    // highlight-next-line\n    "authors": [...omit...]\n  },\n  {\n    "id": 7, \n    "name": "Programming TypeScript",\n    "edition": 1,\n    "price": 47.5,\n    // highlight-next-line\n    "authors": [...omit...]\n  },\n  {\n    "id": 10,\n    "name": "GraphQL in Action",\n    "edition": 1,\n    "price": 80, \n    // highlight-next-line\n    "authors": [...omit...]\n  }\n]\n')),(0,o.kt)("h2",{id:"cache-invalidation"},"Cache Invalidation"),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"To use Jimmer's automatic cache invalidation, ",(0,o.kt)("a",{parentName:"p",href:"../../mutation/trigger"},"triggers")," need to be enabled first.")),(0,o.kt)("h3",{id:"one-to-many-bookstorebooks-1"},"One-to-Many: BookStore.books"),(0,o.kt)("p",null,"Modify the foreign key ",(0,o.kt)("inlineCode",{parentName:"p"},"STORE_ID")," of the BOOK table, Jimmer automatically deletes the many-to-one association cache ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store")," and the one-to-many association cache ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore.books"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If BinLog trigger is enabled, modifying the database by any means can lead to Jimmer's cache consistency intervention. For example, directly execute the following SQL in the SQL IDE:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"update BOOK\n/* Old value: 1, New value: 2 */\nset STORE_ID = 2\nwhere ID = 7;\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If only Transaction trigger is enabled, Jimmer's API must be used to modify the database:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"BookTable table = Tables.BOOK_TABLE;\nsqlClient\n    .createUpdate(table)\n    // Old value: 1L, New value: 2L  \n    .set(table.store().id, 2L)\n    .where(table.id().eq(7L))\n    .execute();\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient\n    .createUpdate(Book::class) {\n        // Old value: 1L, New value: 2L\n        set(table.store.id, 2L)\n        where(table.id eq 7L)\n    }\n    .execute()\n")))))),(0,o.kt)("p",null,"Regardless of which way above is used to modify the data, you will see the following log output:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Delete data from redis: [Book-7]  \nDelete data from redis: [Book.store-7] \u2776\nDelete data from redis: [BookStore.books-1] \u2777\nDelete data from redis: [BookStore.books-2] \u2778\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u2776 For the Book object with id ",(0,o.kt)("inlineCode",{parentName:"li"},"7"),", its many-to-one association cache ",(0,o.kt)("inlineCode",{parentName:"li"},"Book.store")," is deleted."),(0,o.kt)("li",{parentName:"ul"},"\u2777 For the BookStore object with id ",(0,o.kt)("inlineCode",{parentName:"li"},"1")," ",(0,o.kt)("em",{parentName:"li"},"(old value before modification)"),", its one-to-many association cache ",(0,o.kt)("inlineCode",{parentName:"li"},"BookStore.books")," is deleted. "),(0,o.kt)("li",{parentName:"ul"},"\u2778 For the BookStore object with id ",(0,o.kt)("inlineCode",{parentName:"li"},"2")," ",(0,o.kt)("em",{parentName:"li"},"(new value before modification)"),", its one-to-many association cache ",(0,o.kt)("inlineCode",{parentName:"li"},"BookStore.books")," is deleted.")),(0,o.kt)("h3",{id:"many-to-many-bookauthors-1"},"Many-to-Many: Book.authors"),(0,o.kt)("p",null,"Inserting data into the join table ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_AUTHOR_MAPPING")," automatically deletes the many-to-many association caches ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author.books"),"."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Deleting data from the join table can achieve the same effect. Here insertion is used to demonstrate the effect.")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If BinLog trigger is enabled, modifying the database by any means can lead to Jimmer's cache consistency intervention. For example, directly execute the following SQL in the SQL IDE:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"insert into\nBOOK_AUTHOR_MAPPING(BOOK_ID, AUTHOR_ID) \nvalues(10, 3);\n"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If only Transaction trigger is enabled, Jimmer's API must be used to modify the database:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"sqlClient\n    .getAssociations(BookProps.AUTHORS)\n    .save(10L, 3L);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"sqlClient\n    .getAssociations(Book::authors)\n    .save(10L, 3L);\n")))))),(0,o.kt)("p",null,"Regardless of which way above is used to modify the data, you will see the following log output:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Delete data from redis: [Book.authors-10] \u2776\nDelete data from redis: [Author.books-3] \u2777\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u2776 For the Book object with id ",(0,o.kt)("inlineCode",{parentName:"li"},"10"),", its many-to-many association cache ",(0,o.kt)("inlineCode",{parentName:"li"},"Book.authors")," is deleted."),(0,o.kt)("li",{parentName:"ul"},"\u2777 For the Author object with id ",(0,o.kt)("inlineCode",{parentName:"li"},"3"),", its many-to-many association cache ",(0,o.kt)("inlineCode",{parentName:"li"},"Author.books")," is deleted.")),(0,o.kt)("h2",{id:"notes-on-logical-deletion"},"Notes on Logical Deletion"),(0,o.kt)("p",null,"If associated objects support ",(0,o.kt)("a",{parentName:"p",href:"../../query/global-filter/logical-deleted"},"logical deletion"),", association caching is still supported by default. "),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"However, once the logical deletion is ",(0,o.kt)("a",{parentName:"p",href:"../../query/global-filter/logical-deleted#ignore-logical-deletion-filter"},"ignored")," or ",(0,o.kt)("a",{parentName:"p",href:"../../query/global-filter/logical-deleted#reverse-logical-deletion-filter"},"reversed"),", association caching will be ignored.")))}A.isMDXComponent=!0},64608:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/association-cache-dbeabc0a449a23469331c7bd822e1540.webp"},29148:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/calculated-cache-b73a5f78ce1bc73348621025d583aa47.webp"},68393:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cloud-4029a49b29895e2ef7f199be53c647c8.webp"},86116:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/consistency-782cc1bfaf8d5f2c50a6cf4fd290c383.webp"},74513:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dto-explosion-f0066fdbe10e41d79a21628460e40468.webp"},78706:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/generated-java-32e67690ba94b4f0d63bbd248844dd71.webp"},55666:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/generated-kt-2d53fe7a5ad2ee91828171f07954eea8.webp"},12036:(e,t,a)=>{a.d(t,{Z:()=>n});const n="data:image/webp;base64,UklGRlwDAABXRUJQVlA4WAoAAAAoAAAAIwAAHwAASUNDUBQCAAAAAAIUYXBwbAQAAABtbnRyUkdCIFhZWiAH5wADABkAEgA3ABdhY3NwQVBQTAAAAABBUFBMAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWFwcGzwmkVkcoBXfc7VHI8vo5G3AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkZXNjAAAA/AAAAGVjcHJ0AAABZAAAACN3dHB0AAABiAAAABRyWFlaAAABnAAAABRnWFlaAAABsAAAABRiWFlaAAABxAAAABRyVFJDAAAB2AAAABBjaGFkAAAB6AAAACxiVFJDAAAB2AAAABBnVFJDAAAB2AAAABBkZXNjAAAAAAAAAAtVMjdVMkc2UjRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHRleHQAAAAAQ29weXJpZ2h0IEFwcGxlIEluYy4sIDIwMjMAAFhZWiAAAAAAAADz2AABAAAAARYIWFlaIAAAAAAAAHLJAAA6rAAAAZFYWVogAAAAAAAAXQgAALT9AAAPUFhZWiAAAAAAAAAnBQAAEFYAAMJMcGFyYQAAAAAAAAAAAAH2BHNmMzIAAAAAAAELtwAABZb///NXAAAHKQAA/df///u3///9pgAAA9oAAMD2VlA4IK4AAABQBgCdASokACAAPo04mEelIyKhMBVdUKARiWIAxPLgLf/smI7f4opUf8y4Na5nNiiOM9fdUSb/n/4qAAD+76lTf73FZ+2hhhPQzsV9rZahOwFWYzUW6kNtghYCTvo/PpeTwWM9j+YlVt+tUxq84FN9eUFzu7J4H42kzR6StHV7YV1WZG+EvIW3H4gjv94UShhqQ2cvrX/y91uP4+a/hCq3skB3vjdta+qP9EVAAABFWElGbAAAAE1NACoAAAAIAAQBGgAFAAAAAQAAAD4BGwAFAAAAAQAAAEYBKAADAAAAAQACAACHaQAEAAAAAQAAAE4AAAAAAAAAkAAAAAEAAACQAAAAAQACoAIABAAAAAEAAAAkoAMABAAAAAEAAAAgAAAAAA=="},34502:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/graphiql-headers-676e3ff2a6da158f8a8b2b0d43633896.webp"},71876:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/multi-view-cache-57a9e6ec32df6b23eceac9376d0268d1.webp"},61278:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/object-cache-5a67daa9966fe7b728af64423333ba74.webp"},21283:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/public-wechat-dfd717c8dce4e5464c055768e06cb22b.webp"},91059:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/save-d37c62a7516ccbf2bc561f935cf77de2.webp"},66003:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/shape-ba5246fcd39e013ea28a73144614bd9d.webp"},65048:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/swagger-authorize-144b7e355d1d59381a6fa660b743e2a7.webp"},55515:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/api-2a7966c9db85aec24ae0d1fe0cb62c17.webp"},20466:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/code-bfdfb727fb3ccc54d12fe6a4c5ddc58f.webp"},98272:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/family-b9c1857991f5f8d662444aa9f6e2b85f.webp"},27557:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/field-05834b18f87cfe96cfd1d1a72750e9e5.webp"},69339:(e,t,a)=>{a.d(t,{Z:()=>n});const n="data:image/webp;base64,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"}}]);