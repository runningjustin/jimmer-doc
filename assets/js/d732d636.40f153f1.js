"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[3624],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=o,f=c["".concat(s,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(f,r(r({ref:t},d),{},{components:n})):a.createElement(f,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),o=n(34334);const i="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(i,r),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(83117),o=n(67294),i=n(34334),r=n(72389),l=n(67392),s=n(7094),p=n(12466);const d="tabList__CuJ",u="tabItem_LNqP";function c(e){var t;const{lazy:n,block:r,defaultValue:c,values:m,groupId:f,className:h}=e,k=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=m??k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),v=(0,l.l)(b,((e,t)=>e.value===t.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const y=null===c?c:c??(null==(t=k.find((e=>e.props.default)))?void 0:t.props.value)??k[0].props.value;if(null!==y&&!b.some((e=>e.value===y)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${y}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:g,setTabGroupChoices:N}=(0,s.U)(),[w,O]=(0,o.useState)(y),A=[],{blockElementScrollPositionUntilNextRender:T}=(0,p.o5)();if(null!=f){const e=g[f];null!=e&&e!==w&&b.some((t=>t.value===e))&&O(e)}const C=e=>{const t=e.currentTarget,n=A.indexOf(t),a=b[n].value;a!==w&&(T(t),O(a),null!=f&&N(f,String(a)))},j=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=A.indexOf(e.currentTarget)+1;n=A[t]??A[0];break}case"ArrowLeft":{const t=A.indexOf(e.currentTarget)-1;n=A[t]??A[A.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,i.Z)("tabs-container",d)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":r},h)},b.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>A.push(e),onKeyDown:j,onFocus:C,onClick:C},r,{className:(0,i.Z)("tabs__item",u,null==r?void 0:r.className,{"tabs__item--active":w===t})}),n??t)}))),n?(0,o.cloneElement)(k.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function m(e){const t=(0,r.Z)();return o.createElement(c,(0,a.Z)({key:String(t)},e))}},59991:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>u});var a=n(83117),o=(n(67294),n(3905)),i=n(65488),r=n(85162);const l={sidebar_position:8,title:"Other Features"},s=void 0,p={unversionedId:"mutation/save-command/other",id:"mutation/save-command/other",title:"Other Features",description:"Save Command Result",source:"@site/docs/mutation/save-command/other.mdx",sourceDirName:"mutation/save-command",slug:"/mutation/save-command/other",permalink:"/jimmer-doc/docs/mutation/save-command/other",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/mutation/save-command/other.mdx",tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8,title:"Other Features"},sidebar:"tutorialSidebar",previous:{title:"Optimistic/Pessimistic Lock",permalink:"/jimmer-doc/docs/mutation/save-command/lock"},next:{title:"Input DTO",permalink:"/jimmer-doc/docs/mutation/save-command/input-dto/"}},d={},u=[{value:"Save Command Result",id:"save-command-result",level:2},{value:"AppendOnly Mode",id:"appendonly-mode",level:2}],c={toc:u};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"save-command-result"},"Save Command Result"),(0,o.kt)("p",null,"The result returned by a save command is an object, e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"SimpleSaveResult<E>/KSimpleSaveResult<E>")," for the ",(0,o.kt)("inlineCode",{parentName:"p"},"save")," method that saves a single object."),(0,o.kt)("p",null,"The result supports the following behaviors:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"originalEntity")," property: Returns the original parameter passed to the ",(0,o.kt)("inlineCode",{parentName:"p"},"save")," method by the developer.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"modifiedEntity")," property: A data structure identical in shape to ",(0,o.kt)("inlineCode",{parentName:"p"},"originalEntity"),", with the differences:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If ",(0,o.kt)("inlineCode",{parentName:"p"},"originalEntity")," contains some objects without id properties that rely on id generation strategies ",(0,o.kt)("em",{parentName:"p"},"(e.g. auto increment, sequence, UUID, snowflake id etc.)"),", the corresponding objects in ",(0,o.kt)("inlineCode",{parentName:"p"},"modifiedEntity")," will necessarily have the id property set to the value automatically assigned by the database/application.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"If some objects belong to entity types with optimistic locking fields, the ",(0,o.kt)("inlineCode",{parentName:"p"},"version")," properties of the corresponding objects in ",(0,o.kt)("inlineCode",{parentName:"p"},"modifiedEntity")," will have the latest version number after modification."))),(0,o.kt)("admonition",{parentName:"li",type:"info"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"modifiedEntity")," is discussed many times in previous docs, so is not elaborated here."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"totalAffectedRowCount")," property: The execution of a save command may modify multiple tables in the database. This property summarizes the total number of affected rows across all modified tables.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"getAffectedRowCountMap")," property: A map of affected tables and their affected row counts.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"getAffectedRowCount")," method, taking a parameter to get the affected row count of the specified table. Accepts two kinds of parameters:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Entity type: Gets affected row count of the table corresponding to this entity type.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Association property based on join table: Gets affected row count of the join table corresponding to this association property."))))),(0,o.kt)("p",null,"Let's look at some examples of the ",(0,o.kt)("inlineCode",{parentName:"p"},"totalAffectedRowCount")," property and ",(0,o.kt)("inlineCode",{parentName:"p"},"getAffectedRowCount")," method:"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'SimpleSaveResult<Book> result = sqlClient.update(\n        Objects.createBook(draft -> {\n            draft.setId(3L);\n            draft.setPrice(new BigDecimal("59.9"));\n            draft.addIntoAuthors(author -> author.setId(1L));\n            draft.addIntoAuthors(author -> author.setId(3L));\n            draft.addIntoAuthors(author -> {\n                author.setId(1000L); // does not exist, created automatically\n                author.setFirstName("Svetlana");\n                author.setLastName("Isakova");\n                author.setGender(Gender.FEMALE);\n            });\n        })\n);\nSystem.out.println(\n    "Total affected row count: " + \n    // highlight-next-line\n    result.getTotalAffectedRowCount() \n);\nSystem.out.println(\n    "Affected row count for entity table BOOK: " +\n    // highlight-next-line\n    result.getAffectedRowCount(Book.class)\n); \nSystem.out.println(\n    "Affected row count for entity table AUTHOR: " +\n    // highlight-next-line\n    result.getAffectedRowCount(Author.class)\n);\nSystem.out.println(\n    "Affected row count for join table BOOK_AUTHOR_MAPPING: " +\n    // highlight-next-line\n    result.getAffectedRowCount(BookProps.AUTHORS) \n);\n'))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},'val result = sqlClient.update(\n    new(Book::class).by {\n        id = 3L\n        price = BigDecimal("59.9"))\n        authors().addBy { id = 1L }\n        authors().addBy { id = 3L }\n        authors().addBy {\n            id = 1000L // does not exist, created automatically\n            firstName = "Svetlana"\n            lastName = "Isakova"\n            gender = Gender.FEMALE\n        }\n    }\n);\nprintln(\n    "Total affected row count: " +\n    // highlight-next-line\n    result.totalAffectedRowCount\n)\nprintln(\n    "Affected row count for entity table BOOK: " +\n    // highlight-next-line\n    result.getAffectedRowCount(Book::class)  \n)\nprintln(\n    "Affected row count for entity table AUTHOR: " + \n    // highlight-next-line\n    result.getAffectedRowCount(Author::class)\n)\nprintln(\n    "Affected row count for join table BOOK_AUTHOR_MAPPING: " +\n    // highlight-next-line  \n    result.getAffectedRowCount(Book::authors)\n)\n')))),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The code ",(0,o.kt)("inlineCode",{parentName:"p"},"getAffectedRowCount(BookProps.AUTHORS)")," is equivalent to ",(0,o.kt)("inlineCode",{parentName:"p"},"getAffectedRowCount(AuthorProps.BOOKS)"))),(0,o.kt)("p",null,"The printed result is:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Total affected row count: 5\nAffected row count for entity table BOOK: 1  \nAffected row count for entity table AUTHOR: 1\nAffected row count for join table BOOK_AUTHOR_MAPPING: 3\n")),(0,o.kt)("p",null,"The explanation is:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The affected row count for table ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK")," is 1:"),(0,o.kt)("p",{parentName:"li"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"price")," of the aggregate root object ",(0,o.kt)("inlineCode",{parentName:"p"},"Book(id=3L)")," is modified.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The affected row count for table ",(0,o.kt)("inlineCode",{parentName:"p"},"AUTHOR")," is 1:"),(0,o.kt)("p",{parentName:"li"},"The associated object ",(0,o.kt)("inlineCode",{parentName:"p"},"Author(id=1000L)")," does not exist and is created automatically.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The affected row count for table ",(0,o.kt)("inlineCode",{parentName:"p"},"BOOK_AUTHOR_MAPPING")," is 3:"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Dissociation between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book(id=3L)")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author(id=2L)")," ",(0,o.kt)("em",{parentName:"p"},"(For dissociation operations on join tables, this is deleting the association)"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"New association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book(id=3L)")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author(id=3L)"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"New association between ",(0,o.kt)("inlineCode",{parentName:"p"},"Book(id=3L)")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author(id=1000L)"),"."))))),(0,o.kt)("h2",{id:"appendonly-mode"},"AppendOnly Mode"),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"This is an immature API provided in early deficient documentation to address the inability of initial users to understand why save commands need keys."),(0,o.kt)("p",{parentName:"admonition"},"It violates the core design philosophy of save commands, leading to severely degraded capabilities, and may be removed in the future. Usage should be avoided.  ")),(0,o.kt)("p",null,"There are two usage methods:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Set specific association properties to AppendOnly mode"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"Book book = ...\nsqlClient\n    .getEntities()\n    .saveCommand(book)\n    // highlight-next-line\n    .setAppendOnly(BookProps.AUTHORS)\n    .execute();\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"val book = ...\nsqlClient.saveBook(book) {\n    // highlight-next-line\n    setAppendOnly(BookProps.AUTHORS)\n}\n"))))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Set all association properties to AppendOnly mode"),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},"Book book = ...\nsqlClient\n    .getEntities()\n    .saveCommand(book)\n    // highlight-next-line\n    .setAppendOnlyAll()\n    .execute();\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"val book = ...\nsqlClient.saveBook(book) {\n    // highlight-next-line\n    setAppendOnlyAll()\n}\n")))))),(0,o.kt)("p",null,"Regardless of usage, once enabled, the consequences are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Idempotency of saving associated objects is lost."),(0,o.kt)("p",{parentName:"li"},"This config allows associated objects to have neither id nor key properties, resulting in unconditional insertion of associated objects.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Associated properties lose ",(0,o.kt)("a",{parentName:"p",href:"./dissociation"},"dissociation")," capability."),(0,o.kt)("p",{parentName:"li"},"This config will only insert or update the associated objects provided by the user, and will not dissociate other associated objects existing in the database but absent from the data structure to be saved."))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The author believes this API runs counter to the core philosophy of save commands, and should not be retained."),(0,o.kt)("p",{parentName:"admonition"},"You are welcome to share your insights. Please see ",(0,o.kt)("a",{parentName:"p",href:"../../resource/discuss"},"Discussions"),".")))}m.isMDXComponent=!0}}]);