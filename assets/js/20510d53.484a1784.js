"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[1079],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),m=l,b=d["".concat(s,".").concat(m)]||d[m]||p[m]||r;return n?a.createElement(b,o(o({ref:t},u),{},{components:n})):a.createElement(b,o({ref:t},u))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),l=n(34334);const r="tabItem_Ymn6";function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(r,o),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(83117),l=n(67294),r=n(34334),o=n(72389),i=n(67392),s=n(7094),c=n(12466);const u="tabList__CuJ",p="tabItem_LNqP";function d(e){var t;const{lazy:n,block:o,defaultValue:d,values:m,groupId:b,className:h}=e,k=l.Children.map(e.children,(e=>{if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),f=m??k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),N=(0,i.l)(f,((e,t)=>e.value===t.value));if(N.length>0)throw new Error(`Docusaurus error: Duplicate values "${N.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const v=null===d?d:d??(null==(t=k.find((e=>e.props.default)))?void 0:t.props.value)??k[0].props.value;if(null!==v&&!f.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${f.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:g,setTabGroupChoices:y}=(0,s.U)(),[w,T]=(0,l.useState)(v),_=[],{blockElementScrollPositionUntilNextRender:j}=(0,c.o5)();if(null!=b){const e=g[b];null!=e&&e!==w&&f.some((t=>t.value===e))&&T(e)}const O=e=>{const t=e.currentTarget,n=_.indexOf(t),a=f[n].value;a!==w&&(j(t),T(a),null!=b&&y(b,String(a)))},I=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=_.indexOf(e.currentTarget)+1;n=_[t]??_[0];break}case"ArrowLeft":{const t=_.indexOf(e.currentTarget)-1;n=_[t]??_[_.length-1];break}}null==(t=n)||t.focus()};return l.createElement("div",{className:(0,r.Z)("tabs-container",u)},l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":o},h)},f.map((e=>{let{value:t,label:n,attributes:o}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>_.push(e),onKeyDown:I,onFocus:O,onClick:O},o,{className:(0,r.Z)("tabs__item",p,null==o?void 0:o.className,{"tabs__item--active":w===t})}),n??t)}))),n?(0,l.cloneElement)(k.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):l.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function m(e){const t=(0,o.Z)();return l.createElement(d,(0,a.Z)({key:String(t)},e))}},79573:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>c,toc:()=>p});var a=n(83117),l=(n(67294),n(3905)),r=n(65488),o=n(85162);const i={sidebar_position:4,title:"4.4 Dynamic Table Join"},s=void 0,c={unversionedId:"showcase/where/dynamic-join",id:"showcase/where/dynamic-join",title:"4.4 Dynamic Table Join",description:"Usage",source:"@site/docs/showcase/where/dynamic-join.mdx",sourceDirName:"showcase/where",slug:"/showcase/where/dynamic-join",permalink:"/jimmer-doc/docs/showcase/where/dynamic-join",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/showcase/where/dynamic-join.mdx",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"4.4 Dynamic Table Join"},sidebar:"tutorialSidebar",previous:{title:"4.3 Associated Id",permalink:"/jimmer-doc/docs/showcase/where/associated-id"},next:{title:"4.5 Implicit Subquery",permalink:"/jimmer-doc/docs/showcase/where/implicit-subquery"}},u={},p=[{value:"Usage",id:"usage",level:2},{value:"Various Situations",id:"various-situations",level:2},{value:"All table joins do not take effect",id:"all-table-joins-do-not-take-effect",level:3},{value:"Some table joins take effect",id:"some-table-joins-take-effect",level:3},{value:"All table joins take effect",id:"all-table-joins-take-effect",level:3},{value:"IsNull\u548c\u5916\u8fde\u63a5",id:"isnull\u548c\u5916\u8fde\u63a5",level:2}],d={toc:p};function m(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"usage"},"Usage"),(0,l.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"@Nullable String storeName = ...Omitted...;\n@Nullable String storeWebsite = ...Omitted...;\n\nBookTable table = BookTable.$;\nList<Book> books = sqlClient\n    .createQuery(table)\n    .where(table.store().name().eqIf(storeName)) \u2776\n    .where(table.store().website().eqIf(storeWebsite)) \u2777\n    .select(table)\n    .execute();\n"))),(0,l.kt)(o.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val storeName: String? = ...Omitted...\nval storeWebsite: String? = ...Omitted...\n\nval books = sqlClient\n    .createQuery(Book::class) {\n        where(table.store.name `eq?` storeName) \u2776\n        where(table.store.website `eq?` storeWebsite) \u2777\n        select(table)\n    }\n    .execute()\n")))),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"In the above code, Java's ",(0,l.kt)("inlineCode",{parentName:"p"},"table.store()")," and Kotlin's ",(0,l.kt)("inlineCode",{parentName:"p"},"table.store")," represent the inner join between the table defined by ",(0,l.kt)("inlineCode",{parentName:"p"},"Book")," and the table defined by ",(0,l.kt)("inlineCode",{parentName:"p"},"BookStore")," through the many-to-one association ",(0,l.kt)("inlineCode",{parentName:"p"},"Book.store"),". "),(0,l.kt)("p",{parentName:"admonition"},"That is, the following SQL logic is represented:"),(0,l.kt)("pre",{parentName:"admonition"},(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"from BOOK b inner join BOOK_STORE s on b.STORE_ID = s.ID\n")),(0,l.kt)("p",{parentName:"admonition"},"In fact, if the entity model is richer, longer paths can be written, such as ",(0,l.kt)("inlineCode",{parentName:"p"},"table.store().city().province()"),"."),(0,l.kt)("p",{parentName:"admonition"},"Here, just for quick start guide and preview, it is unnecessary to build a richer entity model to demonstrate longer paths. The shortest table chain join path ",(0,l.kt)("inlineCode",{parentName:"p"},"table.store()")," is enough. ")),(0,l.kt)("h2",{id:"various-situations"},"Various Situations"),(0,l.kt)("h3",{id:"all-table-joins-do-not-take-effect"},"All table joins do not take effect"),(0,l.kt)("p",null,"If both ",(0,l.kt)("inlineCode",{parentName:"p"},"storeName")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"storeWebsite")," are null, it will cause the dynamic table joins created at \u2776 and \u2777 to be unused. Unused table joins will be automatically ignored without rendering any actual SQL joins."),(0,l.kt)("p",null,"At this time, the following SQL is generated:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE,\n    tb_1_.STORE_ID\nfrom BOOK tb_1_\n")),(0,l.kt)("h3",{id:"some-table-joins-take-effect"},"Some table joins take effect"),(0,l.kt)("p",null,"If ",(0,l.kt)("inlineCode",{parentName:"p"},"storeName")," is specified as non-null while ",(0,l.kt)("inlineCode",{parentName:"p"},"storeWebsite")," remains null, the dynamic table join at \u2776 takes effect, while the dynamic table join at \u2777 is ignored."),(0,l.kt)("p",null,"At this time, the following SQL is generated:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE,\n    tb_1_.STORE_ID\nfrom BOOK tb_1_\ninner join BOOK_STORE tb_2_\n    on tb_1_.STORE_ID = tb_2_.ID\nwhere\n    tb_2_.NAME = ? /* MANNING */\n")),(0,l.kt)("h3",{id:"all-table-joins-take-effect"},"All table joins take effect"),(0,l.kt)("p",null,"If both ",(0,l.kt)("inlineCode",{parentName:"p"},"storeName")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"storeWebsite")," are specified as non-null, the dynamic table joins created at \u2776 and \u2777 will both take effect.  "),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"Jimmer can automatically merge conflicting table joins. The two joins will be merged into one.\nUltimately, only one SQL join will be rendered ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"select\n    tb_1_.ID,\n    tb_1_.NAME,\n    tb_1_.EDITION,\n    tb_1_.PRICE,\n    tb_1_.STORE_ID\nfrom BOOK tb_1_\ninner join BOOK_STORE tb_2_\n    on tb_1_.STORE_ID = tb_2_.ID\nwhere\n        tb_2_.NAME = ? /* MANNING */\n    and\n        tb_2_.WEBSITE = ? /* https://www.manning.com */\n")),(0,l.kt)("h2",{id:"isnull\u548c\u5916\u8fde\u63a5"},"IsNull\u548c\u5916\u8fde\u63a5"),(0,l.kt)("p",null,"\u7c7b\u4f3cJava\u4e2d",(0,l.kt)("inlineCode",{parentName:"p"},"table.store()"),"\u6216Kotlin",(0,l.kt)("inlineCode",{parentName:"p"},"table.store"),"\u8fd9\u6837\u7684\u8fde\u63a5\u8def\u5f84\uff0c\u4f1a\u88ab\u6e32\u67d3\u6210SQL\u7684\u5185\u8fde\u63a5\uff0c\u800c\u975e\u5916\u8fde\u63a5\uff0c\u8fd9\u662f\u56e0\u4e3a"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},"\u5185\u8fde\u63a5\u6bd4\u5916\u94fe\u63a5\u62e5\u6709\u66f4\u597d\u7684\u6027\u80fd\uff01")),(0,l.kt)("admonition",{type:"caution"},(0,l.kt)("p",{parentName:"admonition"},"\u4e3a\u6b64\uff0cJimmer\u4e0d\u60dc\u901a\u8fc7\u5f02\u5e38\u8ba9\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5185\u8fde\u63a5\u800c\u5f97\u5230\u7684\u8868\u5bf9\u8c61\u4e0d\u652f\u6301",(0,l.kt)("inlineCode",{parentName:"p"},"isNull"),"\u3002"),(0,l.kt)("p",{parentName:"admonition"},"\u5982\u679c\u8981\u5bf9\u5173\u8054\u5bf9\u8c61\u65bd\u52a0",(0,l.kt)("inlineCode",{parentName:"p"},"isNull"),"\uff0c\u5fc5\u987b\u660e\u786e\u91c7\u7528\u5916\u8fde\u63a5\u64cd\u4f5c\uff0c\u4f8b\u5982")),(0,l.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"TreeNodeTable table = TreeNodeTable.$;\nList<TreeNode> rootNodes = sqlClient\n    .createQuery(table)\n    // highlight-next-line\n    .where(table.parent(JoinType.LEFT).isNull())\n    .select(table)\n    .execute();\n"))),(0,l.kt)(o.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val rootNodes = sqlClient\n    .createQuery(TreeNode::class) {\n        // highlight-next-line\n        where(table.`parent?`.isNull())\n        select(table)\n    }\n    .execute()\n")))),(0,l.kt)("p",null,"Java\u4ee3\u7801\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},".parent(JoinType.LEFT)"),"\u548cKotlin\u4ee3\u7801\u4e2d\u7684",(0,l.kt)("inlineCode",{parentName:"p"},".parent?"),"\u8868\u793a\u5de6\u8fde\u63a5\u3002"),(0,l.kt)("p",null,"\u5176\u5b9e\uff0c\u8fd9\u79cd\u6848\u4f8b\u66f4\u9002\u5408",(0,l.kt)("a",{parentName:"p",href:"./associated-id"},"\u4e0a\u4e00\u6587"),"\u4e2d\u7684\u5173\u8054id\u6761\u4ef6"),(0,l.kt)(r.Z,{groupId:"language",mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-java"},"TreeNodeTable table = TreeNodeTable.$;\nList<TreeNode> rootNodes = sqlClient\n    .createQuery(table)\n    // highlight-next-line\n    .where(table.parentId().isNull())\n    .select(table)\n    .execute();\n"))),(0,l.kt)(o.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-kotlin"},"val rootNodes = sqlClient\n    .createQuery(TreeNode::class) {\n        // highlight-next-line\n        where(table.parentId.isNull())\n        select(table)\n    }\n    .execute()\n")))))}m.isMDXComponent=!0}}]);