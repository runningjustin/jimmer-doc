"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[6326],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,h=d["".concat(s,".").concat(m)]||d[m]||c[m]||i;return n?a.createElement(h,r(r({ref:t},u),{},{components:n})):a.createElement(h,r({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294),o=n(34334);const i="tabItem_Ymn6";function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(i,r),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(83117),o=n(67294),i=n(34334),r=n(72389),l=n(67392),s=n(7094),p=n(12466);const u="tabList__CuJ",c="tabItem_LNqP";function d(e){var t;const{lazy:n,block:r,defaultValue:d,values:m,groupId:h,className:k}=e,y=o.Children.map(e.children,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),b=m??y.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),f=(0,l.l)(b,((e,t)=>e.value===t.value));if(f.length>0)throw new Error(`Docusaurus error: Duplicate values "${f.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const g=null===d?d:d??(null==(t=y.find((e=>e.props.default)))?void 0:t.props.value)??y[0].props.value;if(null!==g&&!b.some((e=>e.value===g)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${g}" but none of its children has the corresponding value. Available values are: ${b.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:v,setTabGroupChoices:N}=(0,s.U)(),[B,C]=(0,o.useState)(g),T=[],{blockElementScrollPositionUntilNextRender:w}=(0,p.o5)();if(null!=h){const e=v[h];null!=e&&e!==B&&b.some((t=>t.value===e))&&C(e)}const j=e=>{const t=e.currentTarget,n=T.indexOf(t),a=b[n].value;a!==B&&(w(t),C(a),null!=h&&N(h,String(a)))},x=e=>{var t;let n=null;switch(e.key){case"ArrowRight":{const t=T.indexOf(e.currentTarget)+1;n=T[t]??T[0];break}case"ArrowLeft":{const t=T.indexOf(e.currentTarget)-1;n=T[t]??T[T.length-1];break}}null==(t=n)||t.focus()};return o.createElement("div",{className:(0,i.Z)("tabs-container",u)},o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":r},k)},b.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:B===t?0:-1,"aria-selected":B===t,key:t,ref:e=>T.push(e),onKeyDown:x,onFocus:j,onClick:j},r,{className:(0,i.Z)("tabs__item",c,null==r?void 0:r.className,{"tabs__item--active":B===t})}),n??t)}))),n?(0,o.cloneElement)(y.filter((e=>e.props.value===B))[0],{className:"margin-top--md"}):o.createElement("div",{className:"margin-top--md"},y.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==B})))))}function m(e){const t=(0,r.Z)();return o.createElement(d,(0,a.Z)({key:String(t)},e))}},24422:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>c});var a=n(83117),o=(n(67294),n(3905)),i=n(65488),r=n(85162);const l={sidebar_position:1,title:"Feature Introduction"},s=void 0,p={unversionedId:"quick-view/fetch/feature",id:"quick-view/fetch/feature",title:"Feature Introduction",description:"The Simplest Repository",source:"@site/docs/quick-view/fetch/feature.mdx",sourceDirName:"quick-view/fetch",slug:"/quick-view/fetch/feature",permalink:"/jimmer-doc/docs/quick-view/fetch/feature",draft:!1,editUrl:"https://github.com/babyfish-ct/jimmer-doc/tree/main/docs/quick-view/fetch/feature.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"Feature Introduction"},sidebar:"tutorialSidebar",previous:{title:"Query Arbitrary Shape",permalink:"/jimmer-doc/docs/quick-view/fetch/"},next:{title:"Exposing Features",permalink:"/jimmer-doc/docs/quick-view/fetch/export/"}},u={},c=[{value:"The Simplest Repository",id:"the-simplest-repository",level:2},{value:"Improved Repository",id:"improved-repository",level:2},{value:"Usage",id:"usage",level:2},{value:"Query Mutilated Objects",id:"query-mutilated-objects",level:3},{value:"Query Data Structures Composed of Multiple Objects",id:"query-data-structures-composed-of-multiple-objects",level:3}],d={toc:c};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"the-simplest-repository"},"The Simplest Repository"),(0,o.kt)("p",null,"Now let's write a BookRepository for querying Book  "),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookRepository.java"',title:'"BookRepository.java"'},"@Repository\npubic class BookRepository {\n\n    private final JSqlClient sqlClient;\n\n    public BookRepository(JSqlClient sqlClient) {\n        this.sqlClient = sqlClient;\n    }\n\n    @Nullable\n    public Book findBookById(long id) {\n        return sqlClient.findById(Book.class, id);\n    }\n\n    public List<Book> findBooksByName(@Nullable String name) {\n        BookTable table = Tables.BOOK_TABLE;\n        return sqlClient\n                .createQuery(table)\n                .whereIf(\n                    name != null && !name.isEmpty(),  \n                    table.name().ilike(name)\n                )\n                .select(table);\n    }\n}\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookRepository.kt"',title:'"BookRepository.kt"'},"@Repository\nclass BookRepository(\n    private val sqlClient: KSqlClient  \n) {\n\n    fun findBookById(id: Long): Book? =  \n        sqlClient.findById(Book::class, id)  \n\n    fun findBooksByName(name: String?): List<Book> =  \n        sqlClient.createQuery(Book::class) {\n            name?.takeIf { it.isNotEmpty() }?.let {\n                where(table.name ilike name);\n            }\n            select(table) \n        }.execute()\n}\n")))),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"JSqlClient")," in Java code and ",(0,o.kt)("inlineCode",{parentName:"p"},"KSqlClient")," in Kotlin code are the API entry points provided by Jimmer for Java and Kotlin developers.  "),(0,o.kt)("p",{parentName:"li"},"In actual projects, the object is a global object. This chapter document is used for quick preview and does not introduce details. Readers can ignore specific details for the time being and just know that ",(0,o.kt)("inlineCode",{parentName:"p"},"sqlClient")," is the API entry point.  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"The purpose of this article is to control the format of returned objects, not to introduce complex query conditions ",(0,o.kt)("em",{parentName:"p"},"(this part of the content is introduced in ",(0,o.kt)("a",{parentName:"em",href:"../dsl"},"Quick Preview/Arbitrary Dynamic Queries"),")"),".  "),(0,o.kt)("p",{parentName:"li"},"So these two methods symbolically use ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.name")," as filters.  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Jimmer is technically neutral, but using Spring-style code often serves to simplify explanation, so this example uses Spring-style writing.  "),(0,o.kt)("p",{parentName:"li"},"However, for convenience of non-Spring users to read, it deliberately does not use ",(0,o.kt)("a",{parentName:"p",href:"../../spring/repository"},"Jimmer support for Spring Data")," here, but uses the relatively primitive injection of ",(0,o.kt)("inlineCode",{parentName:"p"},"sqlClient"),", which reduces interference from Spring to a minimum.  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"Tables.BOOK_TABLE")," in Java code is code that Jimmer automatically generates at compile time.  "))),(0,o.kt)("p",null,"If there is an instance ",(0,o.kt)("inlineCode",{parentName:"p"},"bookRepository")," of the above class, take ",(0,o.kt)("inlineCode",{parentName:"p"},"findBookById")," as an example:  "),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"System.out.println(bookRepository.findBookById(1L));\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"println(bookRepository.findBookById(1L));  \n")))),(0,o.kt)("p",null,"The output result is as follows:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "id" : 1,\n  "name" : "Learning GraphQL",\n  "edition" : 1,\n  "price" : 50.00,\n  "store" : {\n    "id" : 1\n  }\n}\n')),(0,o.kt)("p",null,"The output format is fixed and does not match the topic \u201cQuery Any Data Structure Shape\u201d we are discussing now, so we need to improve ",(0,o.kt)("inlineCode",{parentName:"p"},"BookRepository"),".  "),(0,o.kt)("h2",{id:"improved-repository"},"Improved Repository"),(0,o.kt)("p",null,"Let's make some minor improvements to the previous ",(0,o.kt)("inlineCode",{parentName:"p"},"BookRepository")," class  "),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="BookRepository.java"',title:'"BookRepository.java"'},"@Repository\npubic class BookRepository {\n\n    private final JSqlClient sqlClient;  \n\n    public BookRepository(JSqlClient sqlClient) {\n        this.sqlClient = sqlClient;\n    }\n\n    @Nullable\n    public Book findBookById(\n        long id,  \n        // highlight-next-line\n        Fetcher<Book> fetcher\n    ) {\n        return sqlClient.findById(\n            // highlight-next-line\n            fetcher,  \n            id  \n        );\n    }\n\n    public List<Book> findBooksByName(\n        @Nullable String name,\n        // highlight-next-line  \n        @Nullable Fetcher<Book> fetcher\n    ) {\n        BookTable table = Tables.BOOK_TABLE;\n        return sqlClient\n                .createQuery(table)\n                .whereIf(  \n                    name != null && !name.isEmpty(),   \n                    table.name().ilike(name)\n                )\n                .select(  \n                    // highlight-next-line\n                    table.fetch(fetcher)\n                );\n    }\n}\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="BookRepository.kt"',title:'"BookRepository.kt"'},"@Repository\nclass BookRepository(\n    private val sqlClient: KSqlClient  \n) {\n\n    fun findBookById(\n        id: Long,\n        // highlight-next-line\n        fetcher: Fetcher<Book>\n    ): Book? =\n        sqlClient.findById(\n            // highlight-next-line\n            fetcher,  \n            id\n        )  \n\n    fun findBooksByName(\n        name: String? = null,\n        // highlight-next-line  \n        fetcher: Fetcher<Book>? = null\n    ): List<Book> =  \n        sqlClient.createQuery(Book::class) {\n            name?.takeIf { it.isNotEmpty() }?.let {\n                where(table.name ilike name); \n            }\n            select( \n                // highlight-next-line  \n                table.fetch(fetcher)\n            )\n        }.execute()  \n}\n")))),(0,o.kt)("p",null,"In this example, we add a parameter of type ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetcher<Book>")," for each query method, through which we can flexibly control the format of the queried object ",(0,o.kt)("em",{parentName:"p"},"(i.e. the shape of the queried data structure)"),".   "),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"This is the recommended usage. The Repository is only responsible for filtering, sorting, paging and other operations, but does not control the format of the returned data. Instead, it exposes the control of the data format through the ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetcher<E>")," parameter to Let the upper layer business logic decide.  ")),(0,o.kt)("h2",{id:"usage"},"Usage"),(0,o.kt)("p",null,"Next, let's still take the ",(0,o.kt)("inlineCode",{parentName:"p"},"findBookById")," method as an example to show two usage scenarios  "),(0,o.kt)("h3",{id:"query-mutilated-objects"},"Query Mutilated Objects"),(0,o.kt)("p",null,"Here, we make the returned format simpler than the default object format. That is, return a mutilated object that has only part of the properties of the complete object.   "),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"System.out.println(\n    bookRepository.findBookById(  \n        1L,\n        // highlight-next-line\n        Fetchers.BOOK_FETCHER  \n            .name()  \n    )  \n);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"println(\n    bookRepository.findBookById(  \n        1L,\n        // highlight-next-line \n        newFetcher(Book::class).by {\n            name()   \n        }  \n    )  \n);  \n")))),(0,o.kt)("p",null,"In the Java code, ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetchers.BOOK_FETCHER")," is code that Jimmer automatically generates at compile time.   "),(0,o.kt)("p",null,"In this example, we let the returned ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," object have only two properties: ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"name")," ",(0,o.kt)("em",{parentName:"p"},"(although only ",(0,o.kt)("inlineCode",{parentName:"em"},"name")," is specified in the code, the ",(0,o.kt)("inlineCode",{parentName:"em"},"id")," property is implicit and will always be queried)"),".  "),(0,o.kt)("p",null,"The result is:  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id" : 1,\n    "name" : "Learning GraphQL"  \n}\n')),(0,o.kt)("p",null,"In the returned result, the ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," object has only the ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"name")," properties, lacking properties such as ",(0,o.kt)("inlineCode",{parentName:"p"},"edition"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"price")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"store"),", which is called a mutilated object.  "),(0,o.kt)("h3",{id:"query-data-structures-composed-of-multiple-objects"},"Query Data Structures Composed of Multiple Objects"),(0,o.kt)("p",null,"Here, we make the returned format more complex than the default object format, including  "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"All non-associated properties of the current object")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Get the associated object ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," through the many-to-one association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.store"),", and let the associated object have all non-associated properties  ")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Get all associated objects ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," through the many-to-many association ",(0,o.kt)("inlineCode",{parentName:"p"},"Book.authors"),", and let each associated object have all non-associated properties  "))),(0,o.kt)(i.Z,{groupId:"language",mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"System.out.println(\n    bookRepository.findBookById( \n        1L, \n        Fetchers.BOOK_FETCHER  \n            .allScalarFields()  \n            .store(\n                Fetchers.BOOK_STORE_FETCHER   \n                    .allScalarFields()\n            )\n            .authors(\n                Fetchers.AUTHOR_FETCHER    \n                    .allScalarFields()\n            )  \n    )  \n);\n"))),(0,o.kt)(r.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-kotlin"},"println(  \n    bookRepository.findBookById(\n        1L,   \n        newFetcher(Book::class).by {  \n            allScalarFields()  \n            store {\n                allScalarFields()   \n            }  \n            authors {   \n                allScalarFields() \n            }\n        }  \n    )\n);\n")))),(0,o.kt)("p",null,"In the above Java code, ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetchers.BOOK_FETCHER"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetchers.BOOK_STORE_FETCHER"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetchers.AUTHOR_FETCHER")," are code that Jimmer automatically generates at compile time.   "),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If you think it is troublesome to frequently write the ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetchers")," prefix in Java code, you can use static import or simply make the current class directly implement the ",(0,o.kt)("inlineCode",{parentName:"p"},"Fetchers")," interface.  ")),(0,o.kt)("p",null,"This time, we will get a complex data structure with the ",(0,o.kt)("inlineCode",{parentName:"p"},"Book")," object as the aggregate root and the ",(0,o.kt)("inlineCode",{parentName:"p"},"BookStore")," object and ",(0,o.kt)("inlineCode",{parentName:"p"},"Author")," object attached through the association properties.   "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "id" : 1,\n    "name" : "Learning GraphQL",\n    "edition" : 1,\n    "price" : 50.00,  \n    // highlight-next-line\n    "store" : {   \n        "id" : 1,  \n        "name" : "O\'REILLY",\n        "website" : null  \n    },  \n    // highlight-next-line\n    "authors" : [{  \n        "id" : 1,  \n        "firstName" : "Eve",  \n        "lastName" : "Procello",\n        "gender" : "FEMALE" \n    }, {\n        "id" : 2,   \n        "firstName" : "Alex",\n        "lastName" : "Banks",  \n        "gender" : "MALE"\n    }]  \n}  \n')),(0,o.kt)("p",null,"Users can control whether any ordinary properties and associated properties are queried without limit in depth and breadth in this way.   "),(0,o.kt)("p",null,"Finally, we can directly obtain capabilities comparable to GraphQL in any code without building any HTTP services."))}m.isMDXComponent=!0}}]);